---
layout: single
published: true
title:  "3.서블릿의 이해"
categories : Jsp
tag : ["java","servlet"]
toc : true
toc_sticky: true
author_profile: true
sidebar :
    nav : "docs"
---



## 서블릿의 개요

1. HttpServlet 클래스를 상속하여 서블릿 클래스로 만들어진다.

2. 서블릿 등록에 필요한 정보를 추가해야한다.

3. 서블릿은 단독으로 실행할 수 없고 서블릿 컨테이너를 통해야한다.



## 동작과정
![servlet_1](https://user-images.githubusercontent.com/68511112/152813040-71133ad9-8d1f-405e-80ea-d3d59323c3ae.png)



1. HttpServlet 클래스 상속 

   HttpServlet 클래스를 상속받는 서블릿 클래스를 구현한다.(MyServelt)

2. load : 서블릿 등록

   서블릿 컨테이너는 url mapping 설정을 참고해서 서블릿을 등록한다. 

3. init() 메서드 실행

   서블릿이 등록되면 서블릿 객체 생성 및 init()메서드를 실행한다.

4. Reqeust과  service()

   클라이언트의 요청들은 스레드로 동시처리되며 각각 service() 메서드를 호출한다.

5. doPost(), doGet()

   service() 메서드는 프로토콜에 따른 doGet(), doPost()메서드를 호출한다.

6. destroy()

   컨테이너 종료 혹은 웹 애플리케이션 종류 시점

7. unload : 서블릿 등록 해제






## 서블릿과 JSP

서블릿은 html응답을 위해서는 자바코드와 html태그를 문자열로 결합하여 사용해야하기 때문에 가독성이 떨어지며 HTML 폼의 데이터처리가 어렵다.
때문에 서블릿은 다음과 같은 조합으로 구현하게 된다

1. 화면 구성 :   JSP
2. REST API 구현 :  JAX-RS
3. 프런트 컨트롤러 모델, 스프링 프레임 워크 등 





## 서블릿 클래스 구조와 생명주기

<p style="font-size:0.8em">
    서블릿은 컨테이너 기반으로 동작하기 때문에 정해진 규격에 의해 프로그래밍 해야한다. <br>
    때문에 <u>기본적인 구조</u>와 <u>생명주기</u>에 대한 이해가 필요하다.
</p>


#### 서블릿 클래스의 구조 

##### 1.HttpServletRequest

Http 프로토콜의 request 정보를 서블릿에 전달하기 위한 목적을 위한 기능으로 구성됨 
이때 사용하는 클래스에는헤더 정보, 파라미터, 쿠키, URL, URL등의 정보를 <u>읽어드리는</u> 
메서드와 HTTP Body의 Stream을 읽어드리는 메서드를 가지고 있음. 
서블릿 컨테이너에서 생성되고 doPost(), doGet() 메서드로 클라이언트 요청이 전달될 때 인자로 
함께 전달된다.



+ HttpServletRequest의 주요 메서드

| 메서드                   | 반환 예                              | 설명                                                         |
| ------------------------ | ------------------------------------ | ------------------------------------------------------------ |
| getParameter(name)       | kim1234                              | name속성으로 전달된 파라미터 값                              |
| getParameterValues(name) | {kim,park,hong}                      | 동일한 name속성으로 전달된 모든 파라미터 값                  |
| getRequestURL()          | http://www.xx.com:8080/shop/list.jsp | url                                                          |
| getRequestURL()          | /shop/list.jsp                       | url에서 스키마,서버 이름, 포트번호를 제외한 나머지 주소와 파라미터 |
| getScheme()              | http                                 | http,https,FTP와 같은 프로토콜                               |
| getServerName()          | www.xxx.com                          | 서버 이름                                                    |
| getServerPort()          | 8080                                 | 서버 포트                                                    |
| getContextPath()         | /shop                                | 콘테스트 경로                                                |
| getMethod()              | GET                                  | GET,POST등의 HTTP 메서드                                     |
| isSecure()               | false                                | SSL의 보안여부                                               |
| getLocale()              | ko_KR                                | 지역 정보                                                    |
| getProtocol()            | HTTP/1.1                             | 사용하는 프로토콜/메이저,마이너 버전                         |
| getLocalAddr()           | 127.0.0.1                            | 서버의 로컬 IP주소                                           |
| getRemoteAddr()          | 210.102.111.212                      | 클라이언트 IP주소                                            |

   

##### 2.HttpServletResponse

서버가 클라이언트에게 응답을 보내는 기능으로 구성됨.
서블릿 컨테이너에서 HttpServletResopnse 객체를 생성하여 서블렛에게 전달된다. 
서블릿은 해당 객체를 이용하여 content type, 응답코드, 응답 메세지 등을 전송할 수 있다. 

   

+ HttpServletResponse의 주요 메서드

| 메서드                                | 설명                                                         |
| ------------------------------------- | ------------------------------------------------------------ |
| sendRedirect(String location)         | 클라이언트에 리다이렉트 응답을 보낸 후 특정 url로 다시 요청하게함 |
| getWriter()                           | 클라이언트로 데이터를 보내기 위한 출력 스트림을 리턴         |
| setContentType(String type)           | 클라이언트에 전달되는 콘텐츠 타입을 지정                     |
| addCookie(Cookie cookie)              | 응답에 쿠키 추가                                             |
| addHeader(String name, String  value) | 헤더에 name과 value를 추가                                   |
| encodeURL(String url)                 | 클라이언트가 쿠키를 지원하지 않을 때 세션id를 포함한 특정 URL을 인코딩 |
| getHeaderNames()                      | 현재 응답에 헤더에 포함된 name을 얻어옴                      |

 

##### 3.서블릿등록

서블릿을 컨테이너에서 실행하기 위해서는 web.xml이나 애너테이션으로 서블릿임을 선언해야한다. 

*애너테이션 방식*

```
@WebServlet("/hello") //어떤 클라이언트 요청에 해당 서블릿을 실행할지 urlPatterns으로 지정
public class HelloWorldServlet extends HttpServlet {
...
}
```



#### 서블릿의 생명주기

##### 생명주기란?

서블릿은 컨테이너 안에서 동작하며 서블릿의 생성부터 종료까지 컨테이너안에서 이루어지는데 이것을 생명주기라고 하며 개발자는 필요에 따라 생명주기 안에서 적절한 기능을 구현할 수 있어야한다.

// 서블릿 동작 과정 이미지 참조

| 이벤트        | 생명 주기 메서드 | 실행                        |
| ------------- | ---------------- | --------------------------- |
| 서블릿 초기화 | init()           | 초기에 한번만 실행됨        |
| 요청/응답     | Service()        | 스레드를 통해 동시에 실행됨 |
| 요청/응답     | doGet(),doPost() | 스레드를 통해 동시에 실행됨 |
| 서블릿 종료   | destroy()        | 종료할 때 한번만 실행됨     |

  1. 서블릿 초기화 :  init() 메서드

     클라이언트 요청이 들어오면 컨테이너는 해당 서블릿이 메모리에 있는지 확인하고, 메모리에 없으면 서블릿의 init()메서드를 호출하여 실행한다. 실행 중 서블릿이 변경되는 경우는 기존 서블릿을 destroy()하고 다시 init()메서드 호출된다.

  2. 요청/응답 : service() 메서드

     서블릿이 실행된 후 요청별로 컨테이너에서 스레드를 생성해 service()메서드를 호출하고, service()메서드를 통해 doGet()이나 doPost()로 분기된다. 이때 request, response객체가 파라미터로 전달된다. 

  3. 서블릿 종료 : destory() 메서드

     컨테이너로부터 서블릿 종료 요청이나 웹 애플리케이션 재등록할 필요가 있을 때 destory()메서드를 호출한다. 서블릿이 종료되면서 동시에 구현해야하는 기능이 있다면 destory() 메서드를 오버라이딩하면 된다. 

