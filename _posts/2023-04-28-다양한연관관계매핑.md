---

layout: single
title: "[JPA 프로그래밍] 6. 다양한 연관관계 매핑"
toc: true
toc_sticky: true
toc_label: " "

---

## 연관관계 매핑시 고려사항 3가지

1. **다중성**
    - 다대일 : `@ManyToOne`
    - 일대다 : `@OneToMany`
    - 일대일 : `@OneToOne`
    - 다대다 : `@ManyToMany`   cf. 실무에서 사용 x
    
2. **단방향, 양방향**
    - 테이블
        - 외래키 하나로 양쪽 조인 가능
        - 방향이라는 개념 있음
    - 객체
        - 참조용 필드가 있는 쪽으로만 참조 가능
        - 한 쪽만 참조하면 단방향
        - 양쪽이 서로 참조하면 양방향
        
3. **연관관계의 주인**
    - 테이블은 외래키 하나로 두 테이블의 연관관계를 찾음
    - 객체 양방향 관계는 A → B, B → A처럼 참조가 2군데
    - 연관관계의 주인: 외래 키를 관리하는 참조
    - 주인의 반대편(mappedBy) : 외래 키에 영향을 주지 않고 단순 조회(참조)만 가능

---

## 다대일 [N:1]

### 다대일 단방향

<img width="450" alt="image" src="https://user-images.githubusercontent.com/114092152/235094989-cb0f88c4-3b86-4a99-8cd7-c5120fb2392d.png">


- 가장 많이 사용하는 연관관계
- 다대일의 반대는 일대다
- **다(N)** 쪽이 외래키

> **관계형 DB에 ERD로 표현** : Member 테이블의 컬럼 하나가 team_id를 외래키로 가지게 됨
> 

> **객체의 연관관계로 표현** : 외래키가 아니라 객체 참조 필드를 쓰면 됨
> 

- Member 객체
    - `@ManyToOne` : Member 객체 입장에서 **다(N)**
    - `@JoinColumn(name = "team_id")` : Team 객체에서 참조하는 DB 매핑 칼럼명 ‘team_id’

```java
@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "member_id")
    private Long id;
    
    @Column(name = "username")
    private String name;
    
    @ManyToOne 
    @JoinColumn(name = "team_id")
    private Team team;
```

- Team 객체

```java
@Entity
public class Team {
    
    @Id @GeneratedValue
    @Column(name = "team_id")
    private Long id;
    private String name;
}
```

- 여러 멤버들이 하나의 팀의 속할 수 있기 때문에 **다대일 관계**

### 다대일 양방향

<img width="450" alt="image" src="https://user-images.githubusercontent.com/114092152/235095141-3174be6c-dd50-4bbb-8565-c5b8db3c85b3.png">

- 외래키가 있는 쪽이 연관관계의 주인
- 양쪽을 서로 참조하도록 개발
- 연관관계가 주인이 아닌 쪽은 단순 조회만 가능하기에 필드만 추가해주면
- mapppedBy 꼭 넣어주기(team에 의해 매핑이 됨)

```java
@OneToMany (mappedBy = "team")
private List<Member> members = new ArrayList<>();
```

---