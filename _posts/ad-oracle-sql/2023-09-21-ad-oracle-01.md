---
title: "[Ad-Oracle-Sql] 1. Sequence"

categories:
  - Ad-Oracle-Sql
tags:
  - [Sequence]

toc: true
toc_sticky: true

date: 2023-09-21
last_modified_at: 2023-09-21
---

{% capture notice-2 %}

üìã This is my note-taking from what I learned in the class "Advanced Database Concepts"
{% endcapture %}

<div class="notice--danger">{{ notice-2 | markdownify }}</div>

<!-- üìã This is my note-taking from what I learned in the LinkedIn Learning course "Explore a Career in SQL Development"
{: .notice--danger} -->

<br>

# Objective

- Define the purpose of a sequence and state how it can be used in a database
- Explain why gaps may appear in the integers generated by a sequence
- Use the CREATE SEQUENCE command to create a sequence
- Call and use sequence values
- Identify which options cannot be changed by the ALTER SEQUENCE command
- Delete a sequence
- Create indexes with the CREATE INDEX command
- Explain the main index structures: B-tree and bitmap
- Verify index use with the explain plan
- Introduce variations on conventional indexes, including a function-based index and an index organized table
- Verify index existence via the data dictionary
- Rename an index with the ALTER INDEX command
- Remove an index using the DELETE INDEX command
- Create and remove a public synonym

<br>

# Database Objects

- An object is anything that has a name and defined structure
  : - Table: Stores data
  : - Sequence: Generates sequential integers
  : - Index: Allows users to quickly locate specific records
  : - Synonym: Alias for other database objects

<br>

# Sequences

- Used for internal control purposes by providing sequential integers for auditing
- Used to generate unique value for primary key column
  : Surrogate key = No correlation with actual row contents

<br>

# Creating a Sequence

- Use the `CREATE SEQUENCE` command
- Various intervals are allowed
  : Default: 1
- You can specify the starting number
  : Default: 1

```
CREATE SEQUENCE sequencename
[INCREMENT BY value]
[START WITH value]
[{MAXVALUE value | NOMAXVALUE}]
[{MINVALUE value | NOMINVALUE}]
[{CYCLE | NOCYCLE}]
[{ORDER | NOORDER}]
[{CACHE value | NOCACHE}];
```

- Can specify `MINVALUE` for decreasing sequence and `MAXVALUE` for increasing sequence
- Numbers can be reused if `CYCLE` is specified
- `ORDER` clause is used in application cluster environment
  : The order clause guarantees that the sequence's next value is the next one in line, no matter the instance that received the request
- Use `CACHE` to pregenerate integers - Default: 20

```
CREATE SEQUENCE orders_order#_seq
  INCREMENT BY 1
  START WITH 1021
  NOCACHE
  NOCYCLE;

-- CREATE SEQUENCE succeeded
```

- To verify the settings for options of a sequence, query `USER_SEQUENCES` data dictionary view

```
SELECT * FROM user_sequences;
```

![img](../../assets/images/USER_SEQUENCES.png)

<br>

# Using Sequence Values

- `NEXTVAL` - Generates integer

```
INSERT INTO orders (order#, customer#, orderdate, shipdate, shipstreet, shipcity, shipstate, shipzip)
  VALUES (orders_order#_seq.NEXTVAL, 1010, '06-APR-09', NULL, '123 WEST MAIN', 'ATLANTA', 'GA', 30418);

-- 1 rows inserted
```

- `CURRVAL` - Contains last integer generated by `NEXTVAL`

```
INSERT INTO orders (order#, customer#, orderdate, shipdate, shipstreet, shipcity, shipstate, shipzip)
  VALUES (orders_order#_seq.CURRVAL, 1010, '06-APR-09', NULL, '123 WEST MAIN', 'ATLANTA', 'GA', 30418);

-- 1 rows inserted
```

- Set Column `DEFAULT` value

```
CREATE SEQUENCE test_defval_seq
  INCREMENT BY 1
  START WITH 100
  NOCACHE
  NOCYCLE;

CREATE TABLE test_defval
  (col1 NUMBER DEFAULT test_defval_seq.NEXTVAL,
   col2 NUMBER);

-- sequence TEST_DEFVAL_SEQ created.
-- table TEST_DEFVAL created.
```

<br>

# Altering Sequence Definitions

- Use `ALTER SEQUENCE` command to change the settings for a sequence
- `START WITH` value cannot be altered - Drop the sequence and re-create it
- Changes cannot make current integers invalid

<br>

# ALTER SEQUENCE Command Example

```
ALTER SEQUENCE orders_order#_seq
  INCREMENT BY 10;

-- ALTER SEQUENCE orders_order#_seq succeeded.
```

<br>

# Removing a Sequence

- Use the `DROP SEQUENCE` command to delete a sequence
- Previous values generated are not affected by removing a sequence from a database

```
DROP SEQUENCE orders_order#_seq;

-- DROP SEQUENCE orders_order#_seq succeeded.
```

<br>

# Create an Identity Column

- Alternative to using sequences to populate primary key columns

```
CREATE TABLE test_ident
  (col1 NUMBER GENERATED AS IDENTITY PRIMARY KEY,
   col2 NUMBER);

-- table TEST_IDENT created.
```

<br>

# Using an Identity Column

```
INSERT INTO test_ident (col2)
  VALUES (350);
INSERT INTO test_ident (col1, col2)
  VALUES (222, 355);
INSERT INTO test_ident (col1, col2)
  VALUES (DEFAULT, 360);
```

![img](../../assets/images/IDENTITYCOLUMN.png)

<br>

# Indexes

- An index stores frequently referenced values and `ROWIDs`
- Can be based on one column, multiple columns, functions, or expressions

<br>

# B-Tree Index

![img](../../assets/images/BTREEINDEX.png)

- Implicitly create an index by `PRIMARY KEY` and `UNIQUE` constraints
- Explicitly create an index by using the `CREATE INDEX` command

<br>

---

<br>

    üñãÔ∏è This is my self-taught blog! Feel free to let me know
    if there are some errors or wrong parts üòÜ

[Back to Top](#){: .btn .btn--primary }{: .align-right}
