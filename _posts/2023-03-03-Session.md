---
title: "Spring MVC : 세션"
categories:
  - Spring
toc: true
toc_label: "목차"
#toc_icon:
toc_sticky: true
#last_modified_at:
---

## 1. 로그인 처리를 위한 코드 준비
이 페이지에서는 세션에 관한 내용을 설명한다. 로그인 기능을 이용해서 이 내용을 설명할 것이므로 로그인과 관련된 몇 가지 필요한 코드를 작성한다.\
먼저 로그인 성공 후 인증 상태 정보를 세션에 보관할 때 사용할 AuthInfo 클래스를 다음과 같이 작성한다.
```java
public class AuthInfo {
    private Long id;
    private String email;
    private String name;

    public AuthInfo(Long id, String email, String name) {
        this.id = id;
        this.email = email
        this.name = name;
    }

    public Long getId() {
        return id;
    }
    
    public String getEmail() {
        return email;
    }

    public String getName() {
        return name;
    }
}
```

이메일과 비밀번호가 일치하는지 확인해서 AuthInfo 객체를 생성하는 AuthService 클래스는 다음과 같다.
```java
public class AuthService {
    private MemberDao memberDao;

    public void setMemberDao(MemberDao memberDao) {
        this.memberDao = memberDao;
    }

    public AuthInfo authenticate(Stirng email, Stirng password) {
        Member member = memberDao.selectByEmail(email);
        if(member == null) {
            throw new WrongIdPasswordException();
        }
        if(!member.mathPassword(password)){
            throw new WrongIdPasswordException();
        }
        return new AuthInfo(member.getId(),
                member.getEmail(),
                member.getName());
    }
}
```

이제 AuthService를 이용해서 로그인 요청을 처리하는 LoginController 클래스는 다음과 같다.
```java
@Controller
@RequestMapping("/login")
public class LoginController {
    private AuthService authService;

    public void setAuthService(AuthService authService) {
        this.authService = authService;
    }

    @GetMapping
    public String form(LoginCommand loginCommand) {
        return "login/loginForm"
    }

    @PostMapping
    public String submit(LoginCommand loginCommand, Errors errors) {
        new LoginCommandValidator().validate(loginCommand, errors);
        if(errors.hasErrors(){
            return "login/loginForm";
        })
        try{
            AuthInfo authInfo = authService.authenticate(
                    loginCommand.getEmail(),
                    loginCommand.getPassword());
            
            //TODO 세션에 authInfo 저장해야 함
            return "login/loginSuccess";
        }catch(WrongIdPasswordException e)  {
            errors.reject("idPasswordNotMatching");
            return "login/loginForm";
        }
    }
}
```
몇몇 class나 jsp는 생략했다.


## Ref.
- 최범균, 스프링프로그래밍입문5, 가메출판사.