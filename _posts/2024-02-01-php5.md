---
layout: single
title: "PHP Getting Data"
categories: note
tags: [php, html, csv]
author_profile: false
search: true
---

```php
// create csv parser class
<?php

class CSVParser{
    public static function parsePeople($csvData) : array {

        $allPeople = array();
        $lines = explode("\n",$csvData);

        for ($i = 1; $i < count($lines); $i++){
            $cols = explode(",", $lines[$i]);

            try{
                if (count($cols) != 7){
                    throw new Exception("Error parsing" . CSV_FILE . " on line $i");
                }
                else{
                    $p = new Person();
                    $p->setFirstName(htmlentities(trim($cols[0])));
                    $p->setLastName(htmlentities(trim($cols[1])));
                    $p->setEmail(htmlentities(trim($cols[2])));
                    $p->setGender(htmlentities(trim($cols[3])));
                    $p->setStreetAddress(htmlentities(trim($cols[4])));
                    $p->setCity(htmlentities(trim($cols[5])));
                    $p->setCountry(htmlentities(trim($cols[6])));

                    $allPeople[] = $p;
                }

            }
            catch(Exception $pe){

            }
        }
        return $allPeople;
    }
}

?>
```

```php
// create file agent class
<?php

class FileAgent{

    public static function appendCSVFile(string $contents){
        try{
            $fh = fopen(CSV_FILE, "a");
            if (!$fh){
                throw new Exception("Cannot open " . CSV_FILE . "for writing");
            }
            fwrite($fh, $contents);
            fclose($fh);
        }
        catch(Exception $fe){
            echo $fe->getMessage();
            error_log($fe->getMessage(), 3, ERROR_LOG);
        }
    }

    public static function readFile() : string{
        try{
            $fh = fopen(CSV_FILE, 'r');
            $fileContents = fread($fh, filesize(CSV_FILE));
            fclose($fh);
        }
        catch(Exception $fe){
            echo $fe->getMessage();
            error_log($fe->getMessage(), 3, ERROR_LOG);
        }
        return $fileContents;
    }
}
```

```error_log
We couldnt open /data/shoes.csv for writingError parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12 Error parsing ./data/shoes.csv on line 12
```

```php
// config.inc.php

<?php

define("CSV_FILE", "./data/people.csv");
define("ERROR_LOG", "./log/error_log");
?>
```
