---
layout: single
published: true
title:  "10.JDBC 기본 구조와 API의 이해"
categories : Jsp
tag : ["java","jsp"]
toc : true
toc_sticky: true
author_profile: true
sidebar :
    nav : "docs"
---

## JDBC 개념

- Java DataBase Connectivity 
- 데이터베이스의 종류는 다양하다. 오라클, H2, MYSQL 등등.. 이러한 데이터베이스들은 데이터를 처리하는 방법이 제각각인데 자바프로그램에서 이러한 서로 다른 데이터베이스에 접속할 수 있도록 설계된 인터페이스가 JDBC이다. 즉 JDBC는 표준화된 방법으로 다른 기종 간의 데이터베이스를 접속할 수 있도록 만든 API규격이다.
  - 개발자는 JDBC API(인터페이스)를 사용해 프로그램 코드를 작성한다.
  -  데이터베이스 연결은 각 데이터베이스 회사가 제공하는 JDBC드라이버를 이용해 SQL문으로 데이터를 조작한다. 



## JDBC 드라이버 설치

- JDBC는 자바 인터페이스, 즉 규격이기만 할 뿐, 실제 구현된 클래스가 없으면 동작하지 않는다.
- 실제 구현된 클래스를 JDBC 드라이버라고하며 라이브러리와 같은 개념임 -> 때문에 JDBC API를 사용하는 프로그램에서는 JDBC 드라이버(라이브러리)가 반드시 필요함(오라클 경우 해당 DB에 포함되어 있거나 별도 다운로드 제공함)
  - Maven 빌드 도구를 사용하는 경우 :  pom.xml에 의존성을 추가한다. 
  - Maven 빌드 도구를 사용하지 않는 경우 : [WEB-INF/lib] 폴더에 관련 라이브러리를 복사한다.
- 메이븐 리포지터리에서 h2를 검색해 코드를 복사하여 pom.xml에 의존성을 추가한다. 
- [Java Resources] -> [Libraries] -> [Maven Dependencies]에 'h2-1.4.200.jar'이 추가되어있으면 정상적으로 등록된 것.

``` 
<dependencies>
<!-- https://mvnrepository.com/artifact/com.h2database/h2 -->
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <version>1.4.200</version>
    <scope>test</scope>
</dependencies>
```



## JDBC 프로그래밍 과정

JDBC 프로그래밍이란 자바에서 데이터베이스 연동 프로그램을 개발하는 것을 말한다. 

JDBC는 자바 인터페이스로 정의된 규격이기에 동작하기 위해서는 실제 구현된 클래스가 필요하다고 했다.이 클래스를 JDBC 드라이버라고 부르며 JDBC API를 사용하여 프로그램을 만들기 위해서는  JDBC 드라이버를 추가해야된다고 앞에서 설명했었다.



### 프로그래밍 단계와 사용 클래스

1. JDBC 드라이버 로드
   - System.setProperty()
   - Class.forName()
2. 데이터베이스 연결
   - java.sql.Connection
3. Statement 생성
   - java.sql.Statement
   - java.sql.PreparedStatement
4. SQL 문 전송
   - java.sql.Statement
     - executeQuery()
     - executeUpdate()
5. 결과 받기 
   - java.sql.ResultSet
6. 연결 해제
   - java.sql.Connection
     - close()

#### 1. 데이터베이스 로드

- 데이터베이스에 접속하려면 먼저 해당 데이터베이스의 JDBC 드라이버를 사전에 로드해야한다. 

- JDBC 드라이버를 로드하는 방법에는 jdbc.drivers라는 시스템 환경 변수에 등록된 내용으로 하는 방법과 Class.forName("데이터베이스 드라이버 클래스 이름")메서드를 이용하여 로드하는 방법이 있다.

- 대표적인 JDBC 드라이버 클래스 이름과 로드 예시
  - 오라클 : Class.forName("oracle.jdbc.driver.OracleDriver");
  - MySQL : Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");
  - H2 :  Class.forName("org.h2.Driver");



#### 2. 데이터베이스 연결

- JDBC URL, DB 사용자 아이디/비밀번호가 필요함

- 데이터베이스마다 JDBC URL이 다르므로 사용하는 데이터베이스 매뉴얼을 참고한다.

- JDBC URL의 구조는 jdbc:하위 프로토콜:데이터 원본 식별자 로 되어있음 

  <hr>

- JDBC 클래스 로딩과 URL이 준비되었으면 실제 데이터베이스를 연결하기 위해 DriverManager의 getConnection() 메서드를 사용한다.

  ```
  Connection test = DriverManager.getConnection(JDBC URL,"아이디","비밀번호");
  ```



#### 3. Statement 생성

- 데이터베이스와 연결을 완료한 후에는 SQL문을 통해 이루어지는데 이때 SQL문을 JDBC에서 처리할 수 있는 객체로 변환해야한다. 이때 사용되는 객체가 Statement 객체이다. 
- SQL문과 데이터를 조합하기 위해 Statement를 상속받는 PreparedStatement를 사용하는 것이 좋음
  - PreparedStatement은 SQL문을 미리 만들어놓고 변수를 따로 입력하는 방식이다. 
  - SQL문에 데이터가 들어가는 부분에 '?'를 넣는다.
    - 예 : PreparedStatement pstmt = conn.prepareStatement("insert into test values(?,?);
  - .setXXX() 형태의 메서드를 통해 데이터를 연결한다.
    - 예 : pstmt.setString(1,request.getParameter("name"));



#### 4. SQL문 전송

- executeQuery() 
  - SELECT 문을 수행할 때 사용
  - 반환값은 ResultSet 클래스 타입
- executeUpdate()
  - UPDATE, DELETE 문을 수행할 때 사용
  - 반환값은 INT 값
  - 처리된 데이터 수, 처리된 로우의 개수를 반환하는데 처리된 항복이 없다면 0을 반환함



#### 5. 결과 받기

- Statement 또는 PreparedStatement의 executeQuery() 를 사용한다.
- 데이터를 가지고 오는 경우에는, 가져온 결과 데이터를 처리하기 위한 ResultSet객체가 필요.
-  ResultSet객체는 검색한 결과에 대해 로우 단위로 가져온다.



#### 6. 연결해제

- 데이터베이스 사용이 종료되면 연결을 해제해주는 것이 좋다. (연결 수에 따라 라이선스 비용이 증가되기 때문)
- 실제 시스템 구현 시에는 DBCP를 사용함 
  - DBCP란?
    - 데이터베이스의 연결이 요청에 따라 이루어지고 종료되는 구조를 보완하여, 미들웨어나 컨테이너에 미리 데이터베이스와의 연결을 미리 만들어두고 요청 클라이언트에 전달하는 구조 
