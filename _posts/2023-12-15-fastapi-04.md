---
layout: single
title: "FastAPI - 04 (FastAPI: Request Body)"
categories: FastAPI
tag: [FastAPI, uvicorn, Request Body]
toc: true
toc_sticky: true
toc_label: "목차"
---
## Request Body

출처: [https://fastapi.tiangolo.com/tutorial/body/](https://fastapi.tiangolo.com/tutorial/body/)  
아래의 내용은 공식 사이트의 내용을 제 경험과 생각을 추가하여 다시 정리한 것 입니다.

### Pydantic's BaseModel

클라이언트에서 API로 데이터를 보낼 때, 그 데이터는 request body로 전송됩니다. 반면에 response body는 API가 클라이언트에게 보내는 데이터입니다. request body를 선언하기 위해서는 아래와 같이 Pydantic 모델을 사용합니다.

```python
from typing import Union

from fastapi import FastAPI
from pydantic import BaseModel  # Pydantic's BaseModel


class Item(BaseModel):  # BaseModel 상속
    # 속성 선언
    name: str       # str 타입, 필수
    description: Union[str, None] = None # str 또는 None 타입, 선택
    price: float    # float 타입, 필수
    tax: Union[float, None] = None  # float 또는 None 타입, 선택


app = FastAPI()


@app.post("/items/")    # POST 메소드
async def create_item(item: Item):  # 경로, 쿼리 파라미터와 같은 패턴
    return item
```

지금까지는 Get 방식으로 웹 브라우저에서 URL을 입력하여 서버에 요청을 보내는 방식을 사용했습니다. 이번에는 Post 방식으로 서버에 요청을 보내는 방식을 사용합니다. Post 방식은 웹 브라우저에서 직접 요청을 보내는 것이 아니라, 웹 브라우저에서 HTML Form을 통해 요청을 보내는 방식입니다. HTML Form을 통해 요청을 보내기 위해 HTML Form이 return 되는 페이지를 만들어야 합니다. 이를 위해 아래의 함수를 추가합니다.

```python
from typing import Union

from fastapi import FastAPI
from fastapi.responses import HTMLResponse # HTMLResponse 추가
from pydantic import BaseModel


class Item(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    tax: Union[float, None] = None


app = FastAPI()


@app.post("/items/")
async def create_item(item: Item):
    return item
### 여기까지 기존 코드 ###

### HTML Form을 return하는 함수 추가 ###
@app.get("/items/new", response_class=HTMLResponse)
async def create_item_form():
    html_content = """
    <html>
        <head>
            <title>Item 생성</title>
            <script>
                async function submitForm(event) {
                    event.preventDefault(); // 폼의 기본 제출 동작 방지

                    // 폼 데이터를 JSON 객체로 변환
                    let formData = new FormData(event.target);
                    let jsonData = Object.fromEntries(formData.entries());

                    // fetch API를 사용하여 데이터를 JSON 형식으로 전송
                    let response = await fetch('/items/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(jsonData)
                    });

                    let result = await response.json();
                    console.log(result); // 응답 출력 (개발자 도구 콘솔에서 확인 가능)
                }
            </script>
        </head>
        <body>
            <h2>새 Item 생성</h2>
            <form onsubmit="submitForm(event)">
                <input type="text" name="name" placeholder="이름" required>
                <input type="text" name="description" placeholder="설명">
                <input type="number" step="0.01" name="price" placeholder="가격" required>
                <input type="number" step="0.01" name="tax" placeholder="세금">
                <input type="submit" value="생성">
            </form>
        </body>
    </html>
    """
    return HTMLResponse(content=html_content)
```

HTML Form을 return 하는 URL을 호출합니다.

```text
http://127.0.0.1:8000/items/new
```

![HTML Form 화면]({{site.url}}/images/fastapi/fastapi-04_01.png)

항목의 값을 입력합니다.

![HTML Form 화면]({{site.url}}/images/fastapi/fastapi-04_02.png)

Submit 버튼을 클릭하고 개발자 도구의 Console을 확인합니다.

![HTML Form 화면]({{site.url}}/images/fastapi/fastapi-04_03.png)

위의 테스트는 **HTML 화면을 작성하고 테스트**를 하였습니다. 아주 번거롭습니다. HTTP Post 방식을 테스트 하기 위해서는 **Postman**을 사용하는 것이 좋습니다. Postman을 사용하는 방법을 추가로 정리하겠습니다. 추가로 위의 테스트는 **Json 형식으로 데이터를 전송**하였습니다.

---

해시태그: #fastapi #uvicorn #request body
