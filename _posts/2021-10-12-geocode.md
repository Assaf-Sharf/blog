```
layout: single
title:  "geocode"
categories: project
tag: [pandas, googlemaps]
toc_label: "Contents"
toc: true
toc_sticky: true
```



# 서울특별시 성동구 가로휴지통현황 20210827

## 데이터 로드


```python
# 라이브러리
import pandas as pd
```


```python
# 데이터 로드
# 기존 euc-kr 데이터 추출형식으로 인해 업소명 오류가 발견되었으며 이를 개선하고자 UTF-8 형식으로 추출하였습니다. 
df_t = pd.read_csv("data/서울특별시 성동구_가로휴지통현황_20210827.csv", encoding="cp949")
df_t.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>도로(가로)명</th>
      <th>주소</th>
      <th>세부위치</th>
      <th>수거 쓰레기 종류</th>
      <th>형태</th>
      <th>수거 담당자</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>고산자로</td>
      <td>서울특별시 성동구 도선동 15-3</td>
      <td>용호공사 옆 거창식당 앞</td>
      <td>일반쓰레기</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
    </tr>
    <tr>
      <th>1</th>
      <td>고산자로</td>
      <td>서울특별시 성동구 도선동 409</td>
      <td>세븐일레븐 앞</td>
      <td>일반+담배꽁초</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
    </tr>
    <tr>
      <th>2</th>
      <td>마장로</td>
      <td>서울특별시 성동구 마장동 792</td>
      <td>마장갈비 앞</td>
      <td>일반쓰레기</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사근동길</td>
      <td>서울특별시 성동구 사근동 33-10</td>
      <td>모닝글로리 서점 앞</td>
      <td>일반쓰레기</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사근동길</td>
      <td>서울특별시 성동구 행당동 1-13</td>
      <td>왕십리역 6번출구 위 공원</td>
      <td>일반쓰레기</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
    </tr>
  </tbody>
</table>
</div>



## 데이터 처리
* 해당 데이터에는 주소만 존재하고 위도와 경도 값이 없기 때문에 지도에 표시하기 위해서는 해당 값을 가져와야 함
* 구글 맵 geocoding api를 활용(주소 값을 통해 위도와 경도값을 추출)

https://github.com/googlemaps/google-maps-services-python


```python
# 라이브러리 로드
# 구글 맵 라이브러리 로드
import googlemaps
from datetime import datetime
```

* 구글맵스를 활용하기 위해서는 구글 api key를 발급받아야 함.
https://console.cloud.google.com/
* 위의 링크에서 사용자 인증정보 api key 발급 진행


```python
# 테스트 진행
gmaps = googlemaps.Client(key='api key')
geocode_result = gmaps.geocode("서울특별시 성동구 도선동 15-3", language="ko")
geocode_result
```




    [{'address_components': [{'long_name': '１５',
        'short_name': '１５',
        'types': ['premise']},
       {'long_name': '도선동',
        'short_name': '도선동',
        'types': ['political', 'sublocality', 'sublocality_level_2']},
       {'long_name': '성동구',
        'short_name': '성동구',
        'types': ['political', 'sublocality', 'sublocality_level_1']},
       {'long_name': '서울특별시',
        'short_name': '서울특별시',
        'types': ['administrative_area_level_1', 'political']},
       {'long_name': '대한민국',
        'short_name': 'KR',
        'types': ['country', 'political']},
       {'long_name': '133-040',
        'short_name': '133-040',
        'types': ['postal_code']}],
      'formatted_address': '대한민국 서울특별시 성동구 도선동 15',
      'geometry': {'location': {'lat': 37.56334890000001, 'lng': 127.0358043},
       'location_type': 'ROOFTOP',
       'viewport': {'northeast': {'lat': 37.56469788029151,
         'lng': 127.0371532802915},
        'southwest': {'lat': 37.56199991970851, 'lng': 127.0344553197085}}},
      'place_id': 'ChIJ88BI5lmjfDURrlmhyiG1DRE',
      'plus_code': {'compound_code': 'H27P+88 대한민국 서울특별시',
       'global_code': '8Q99H27P+88'},
      'types': ['street_address']}]



* 추출된 값이 리스트 안에 딕셔너리 형태로 되어 있고 해당 데이터를 가져오기위한 처리 과정이 필요


```python
# 테스트 진행
ad_value = geocode_result[0].get('geometry').get('location')
t_lat = ad_value.get('lat')
t_long = ad_value.get('lng')
t_lat, t_long
```




    (37.56334890000001, 127.0358043)



* 위도와 경도 값이 정확하게 추출된 것을 확인한 후 반복문을 통해 추출


```python
# 추출된 값을 넣을 수 있는 빈 리스트 생성 
a = []

for i in df_t.index:
    address = df_t.loc[i, "주소"]
    geocode_result = gmaps.geocode(address, language="ko")
    ad_value = geocode_result[0].get('geometry').get('location')
    a.append(ad_value)
a
```




    [{'lat': 37.56334890000001, 'lng': 127.0358043},
     {'lat': 37.5688177, 'lng': 127.0266179},
     {'lat': 37.5653041, 'lng': 127.042324},
     {'lat': 37.5610919, 'lng': 127.0459627},
     {'lat': 37.5610662, 'lng': 127.0391829},
     {'lat': 37.5610662, 'lng': 127.0391829},
     {'lat': 37.5624052, 'lng': 127.0330026},
     {'lat': 37.5629766, 'lng': 127.0330235},
     {'lat': 37.5608503, 'lng': 127.0346933},
     {'lat': 37.5608503, 'lng': 127.0346933},
     {'lat': 37.5578253, 'lng': 127.027423},
     {'lat': 37.548016, 'lng': 127.022123},
     {'lat': 37.5481354, 'lng': 127.0209795},
     {'lat': 37.54469840000001, 'lng': 127.0223406},
     {'lat': 37.5420277, 'lng': 127.0119445},
     {'lat': 37.5434044, 'lng': 127.0117249},
     {'lat': 37.54359350000001, 'lng': 127.0134664},
     {'lat': 37.54359350000001, 'lng': 127.0134664},
     {'lat': 37.5478789, 'lng': 127.0441053},
     {'lat': 37.5418544, 'lng': 127.044989},
     {'lat': 37.5429305, 'lng': 127.0433514},
     {'lat': 37.5429305, 'lng': 127.0433514},
     {'lat': 37.5462824, 'lng': 127.0443475},
     {'lat': 37.5462824, 'lng': 127.0443475},
     {'lat': 37.5368298, 'lng': 127.0605491},
     {'lat': 37.5493153, 'lng': 127.0553269},
     {'lat': 37.5478926, 'lng': 127.0619924},
     {'lat': 37.5440067, 'lng': 127.0566082},
     {'lat': 37.5451586, 'lng': 127.055075},
     {'lat': 37.5453847, 'lng': 127.0653621},
     {'lat': 37.5386452, 'lng': 127.0561247},
     {'lat': 37.5379935, 'lng': 127.0603885},
     {'lat': 37.5403071, 'lng': 127.0626079},
     {'lat': 37.5483258, 'lng': 127.0640172},
     {'lat': 37.5651883, 'lng': 127.0542199},
     {'lat': 37.5607874, 'lng': 127.0665382},
     {'lat': 37.5406351, 'lng': 127.0492027},
     {'lat': 37.5379935, 'lng': 127.0603885},
     {'lat': 37.5403071, 'lng': 127.0626079},
     {'lat': 37.5483258, 'lng': 127.0640172},
     {'lat': 37.5651883, 'lng': 127.0542199},
     {'lat': 37.5406351, 'lng': 127.0492027},
     {'lat': 37.5608742, 'lng': 127.0359618},
     {'lat': 37.5608742, 'lng': 127.0359618},
     {'lat': 37.5630554, 'lng': 127.0367125},
     {'lat': 37.5697415, 'lng': 127.0378637},
     {'lat': 37.5702023, 'lng': 127.0373619},
     {'lat': 37.5644667, 'lng': 127.0280634},
     {'lat': 37.5571395, 'lng': 127.0333298},
     {'lat': 37.5530997, 'lng': 127.0333888},
     {'lat': 37.5551685, 'lng': 127.0361451},
     {'lat': 37.5575762, 'lng': 127.0348363},
     {'lat': 37.5542479, 'lng': 127.0257504},
     {'lat': 37.55493999999999, 'lng': 127.020216},
     {'lat': 37.5519831, 'lng': 127.0230371},
     {'lat': 37.551379, 'lng': 127.0257515},
     {'lat': 37.548188, 'lng': 127.0253811},
     {'lat': 37.5552593, 'lng': 127.0436579},
     {'lat': 37.5552593, 'lng': 127.0436579},
     {'lat': 37.5599172, 'lng': 127.0360692},
     {'lat': 37.5647672, 'lng': 127.041337},
     {'lat': 37.5616469, 'lng': 127.0608431},
     {'lat': 37.5575833, 'lng': 127.0723697},
     {'lat': 37.5518971, 'lng': 127.0692023},
     {'lat': 37.5443681, 'lng': 127.0648871},
     {'lat': 37.5455006, 'lng': 127.053896},
     {'lat': 37.5471773, 'lng': 127.0473802},
     {'lat': 37.5440067, 'lng': 127.0566082},
     {'lat': 37.5413723, 'lng': 127.0632045},
     {'lat': 37.5426768, 'lng': 127.0452874},
     {'lat': 37.546083, 'lng': 127.0449815},
     {'lat': 37.5477759, 'lng': 127.0449633},
     {'lat': 37.5648706, 'lng': 127.0367774},
     {'lat': 37.5665973, 'lng': 127.0269264},
     {'lat': 37.5618505, 'lng': 127.0340352},
     {'lat': 37.5624577, 'lng': 127.0340319},
     {'lat': 37.5453734, 'lng': 127.052078},
     {'lat': 37.5464578, 'lng': 127.0484361},
     {'lat': 37.5478789, 'lng': 127.0441053},
     {'lat': 37.5483205, 'lng': 127.022437},
     {'lat': 37.5475889, 'lng': 127.021032},
     {'lat': 37.5465441, 'lng': 127.0248865},
     {'lat': 37.5434406, 'lng': 127.0145387},
     {'lat': 37.5425516, 'lng': 127.0125339},
     {'lat': 37.5428659, 'lng': 127.0129507},
     {'lat': 37.541153, 'lng': 127.0107917},
     {'lat': 37.5617303, 'lng': 127.0364217},
     {'lat': 37.5710401, 'lng': 127.0383348},
     {'lat': 37.5688966, 'lng': 127.0370119},
     {'lat': 37.55613580000001, 'lng': 127.0338962},
     {'lat': 37.5498491, 'lng': 127.0311323},
     {'lat': 37.5516321, 'lng': 127.035515},
     {'lat': 37.558876, 'lng': 127.0369949},
     {'lat': 37.5557528, 'lng': 127.023912},
     {'lat': 37.5560898, 'lng': 127.0201127},
     {'lat': 37.5537184, 'lng': 127.0243731},
     {'lat': 37.5492286, 'lng': 127.0262378},
     {'lat': 37.5479468, 'lng': 127.0240964},
     {'lat': 37.5586706, 'lng': 127.0405402},
     {'lat': 37.5630005, 'lng': 127.0419245},
     {'lat': 37.5656077, 'lng': 127.0414281},
     {'lat': 37.5649422, 'lng': 127.0545478},
     {'lat': 37.5612819, 'lng': 127.0633333},
     {'lat': 37.560624, 'lng': 127.0677604},
     {'lat': 37.5446009, 'lng': 127.0568847},
     {'lat': 37.5496777, 'lng': 127.0563647},
     {'lat': 37.5552762, 'lng': 127.0710617},
     {'lat': 37.5418197, 'lng': 127.0102397},
     {'lat': 37.5627399, 'lng': 127.0419052},
     {'lat': 37.56987489999999, 'lng': 127.037314},
     {'lat': 37.5648058, 'lng': 127.0360051},
     {'lat': 37.5600579, 'lng': 127.0374109},
     {'lat': 37.5622823, 'lng': 127.03417},
     {'lat': 37.5334931, 'lng': 127.0796173},
     {'lat': 37.56444, 'lng': 127.02995},
     {'lat': 37.5637, 'lng': 127.0322975},
     {'lat': 37.5639923, 'lng': 127.0295342},
     {'lat': 37.5582574, 'lng': 127.0354666},
     {'lat': 37.5545206, 'lng': 127.0204818},
     {'lat': 37.5548631, 'lng': 127.020174},
     {'lat': 37.5544379, 'lng': 127.0207273},
     {'lat': 37.5549336, 'lng': 127.0367427},
     {'lat': 37.5476747, 'lng': 127.0667855},
     {'lat': 37.5410567, 'lng': 127.0453964},
     {'lat': 37.5370384, 'lng': 127.0591445},
     {'lat': 37.5458249, 'lng': 127.0440489},
     {'lat': 37.5451437, 'lng': 127.0578284},
     {'lat': 37.5454221, 'lng': 127.05388},
     {'lat': 37.544511, 'lng': 127.0573611},
     {'lat': 37.54673460000001, 'lng': 127.050026},
     {'lat': 37.5576486, 'lng': 127.0417315},
     {'lat': 37.5714905, 'lng': 127.0374268},
     {'lat': 37.5716772, 'lng': 127.0368969},
     {'lat': 37.55364, 'lng': 127.0209913},
     {'lat': 37.5557295, 'lng': 127.0202294},
     {'lat': 37.5590025, 'lng': 127.031298},
     {'lat': 37.5486868, 'lng': 127.0260977},
     {'lat': 37.5702023, 'lng': 127.0373619},
     {'lat': 37.5639775, 'lng': 127.0409611},
     {'lat': 37.5469982, 'lng': 127.0457535},
     {'lat': 37.5666967, 'lng': 127.0455829},
     {'lat': 37.5549336, 'lng': 127.0367427},
     {'lat': 37.5663079, 'lng': 127.0369547},
     {'lat': 37.5623833, 'lng': 127.0331908},
     {'lat': 37.5571395, 'lng': 127.0333298},
     {'lat': 37.5578253, 'lng': 127.027423},
     {'lat': 37.5562227, 'lng': 127.0197352},
     {'lat': 37.5512857, 'lng': 127.023034},
     {'lat': 37.5483205, 'lng': 127.022437},
     {'lat': 37.5468967, 'lng': 127.0222403},
     {'lat': 37.5438401, 'lng': 127.0153426},
     {'lat': 37.543518, 'lng': 127.0147437},
     {'lat': 37.5474185, 'lng': 127.0259842},
     {'lat': 37.5567648, 'lng': 127.04098},
     {'lat': 37.5664864, 'lng': 127.0440068},
     {'lat': 37.5663079, 'lng': 127.0369547},
     {'lat': 37.5649422, 'lng': 127.0545478},
     {'lat': 37.5609104, 'lng': 127.0639843},
     {'lat': 37.548461, 'lng': 127.0672136},
     {'lat': 37.5517898, 'lng': 127.06919},
     {'lat': 37.5393129, 'lng': 127.05097},
     {'lat': 37.5494444, 'lng': 127.0569323},
     {'lat': 37.537152, 'lng': 127.0606231},
     {'lat': 37.5438853, 'lng': 127.0572038},
     {'lat': 37.5479812, 'lng': 127.0662384},
     {'lat': 37.5484719, 'lng': 127.0627818},
     {'lat': 37.5483159, 'lng': 127.0652644},
     {'lat': 37.5505058, 'lng': 127.0509661},
     {'lat': 37.5513041, 'lng': 127.0460409},
     {'lat': 37.5508115, 'lng': 127.0504428},
     {'lat': 37.5562628, 'lng': 127.0429615},
     {'lat': 37.5484719, 'lng': 127.0627818}]




```python
# 출력된 값을 데이터프레임형태로 변환
df_a = pd.DataFrame(a)
df_a.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lat</th>
      <th>lng</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>37.563349</td>
      <td>127.035804</td>
    </tr>
    <tr>
      <th>1</th>
      <td>37.568818</td>
      <td>127.026618</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37.565304</td>
      <td>127.042324</td>
    </tr>
    <tr>
      <th>3</th>
      <td>37.561092</td>
      <td>127.045963</td>
    </tr>
    <tr>
      <th>4</th>
      <td>37.561066</td>
      <td>127.039183</td>
    </tr>
  </tbody>
</table>
</div>




```python
# concat 함수를 통해 두 데이터프레임 결합, axis=1은 column 기준
df_t = pd.concat([df_t, df_a], axis=1)
df_t
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>도로(가로)명</th>
      <th>주소</th>
      <th>세부위치</th>
      <th>수거 쓰레기 종류</th>
      <th>형태</th>
      <th>수거 담당자</th>
      <th>lat</th>
      <th>lng</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>고산자로</td>
      <td>서울특별시 성동구 도선동 15-3</td>
      <td>용호공사 옆 거창식당 앞</td>
      <td>일반쓰레기</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.563349</td>
      <td>127.035804</td>
    </tr>
    <tr>
      <th>1</th>
      <td>고산자로</td>
      <td>서울특별시 성동구 도선동 409</td>
      <td>세븐일레븐 앞</td>
      <td>일반+담배꽁초</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.568818</td>
      <td>127.026618</td>
    </tr>
    <tr>
      <th>2</th>
      <td>마장로</td>
      <td>서울특별시 성동구 마장동 792</td>
      <td>마장갈비 앞</td>
      <td>일반쓰레기</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.565304</td>
      <td>127.042324</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사근동길</td>
      <td>서울특별시 성동구 사근동 33-10</td>
      <td>모닝글로리 서점 앞</td>
      <td>일반쓰레기</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.561092</td>
      <td>127.045963</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사근동길</td>
      <td>서울특별시 성동구 행당동 1-13</td>
      <td>왕십리역 6번출구 위 공원</td>
      <td>일반쓰레기</td>
      <td>일반 사각 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.561066</td>
      <td>127.039183</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>167</th>
      <td>광나루로</td>
      <td>서울특별시 성동구 광나루로 190</td>
      <td>버스정류장</td>
      <td>담배꽁초, 음료컵</td>
      <td>원형 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.550506</td>
      <td>127.050966</td>
    </tr>
    <tr>
      <th>168</th>
      <td>광나루로</td>
      <td>서울특별시 성동구 광나루로 142-1</td>
      <td>버스정류장</td>
      <td>담배꽁초, 음료컵</td>
      <td>원형 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.551304</td>
      <td>127.046041</td>
    </tr>
    <tr>
      <th>169</th>
      <td>광나루로</td>
      <td>서울특별시 성동구 광나루로 184</td>
      <td>버스정류장</td>
      <td>담배꽁초, 음료컵</td>
      <td>원형 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.550812</td>
      <td>127.050443</td>
    </tr>
    <tr>
      <th>170</th>
      <td>살곶이</td>
      <td>서울특별시 성동구 살곶이 8길 22</td>
      <td>버스정류장</td>
      <td>담배꽁초, 음료컵</td>
      <td>원형 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.556263</td>
      <td>127.042962</td>
    </tr>
    <tr>
      <th>171</th>
      <td>광나루로</td>
      <td>서울특별시 성동구 광나루로 297</td>
      <td>버스정류장</td>
      <td>담배꽁초, 음료컵</td>
      <td>원형 쓰레기통</td>
      <td>가로환경미화원</td>
      <td>37.548472</td>
      <td>127.062782</td>
    </tr>
  </tbody>
</table>
<p>172 rows × 8 columns</p>
</div>



21-10-12 Comments

> 처음써보는 라이브러리를 직접 구글링을 통해 찾아보고 사용해보았는데 많은 시간이 걸렸지만 이 경험이 앞으로 데이터 공부하는데 많은 도움이 될 것으로 생각!!! 
