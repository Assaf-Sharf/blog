---
layout: single
title: Chapter 33 메모리의 동적 할당
date: 2023-12-04 18:56:13 +09:00
categories:
  - Language
tags:
  - C
excerpt: 메모리의 동적 할당에 관한 글입니다.
toc: true
---

# 1 메모리의 동적 할당(dynamic allocation)

>데이터 영역과 스택 영역에 할당되는 메모리의 크기는               
> 컴파일 타임(compile time)에 미리 결정된다.            
하지만 힙 영역의 크기는 프로그램이 실행되는 도중인             
런 타임(run time)에 사용자가 직접 결정하게 된다.

- 메모리의 동적 할당(dynamic allocation)

>메모리의 동적 할당(dynamic allocation)이란 런 타임에 메모리를 할당받는 것을 의미한다.

## 1.1 malloc() 함수

- malloc()

>malloc() 함수는 프로그램이 실행 중일 때            
>사용자가 직접 힙 영역에 메모리를 할당할 수 있게 해준다.

>malloc() 함수의 원형은 다음과 같다.      

- 원형

```c
#include <stdlib.h>
void *malloc(size_t size);  
```

>malloc() 함수는 인수로 할당받고자 하는 메모리의 크기를 바이트 단위로 전달받는다.              
이 함수는 전달받은 메모리 크기에 맞고, 아직 할당되지 않은 적당한 블록을 찾는다.                   
이렇게 찾은 블록의 첫 번째 바이트를 가리키는 주소값을 반환한다.                    

>힙 영역에 할당할 수 있는 적당한 블록이 없을 때에는 널 포인터를 반환한다.                          
주소값을 반환받기 때문에 힙 영역에 할당된         
메모리 공간으로 접근하려면 포인터를 사용해야 한다.

>malloc() 함수의 원형에서 볼 수 있는 size_t 타입은 부호없는 정수이다.

#### free() 함수

free() 함수는 힙 영역에 할당받은 메모리 공간을 다시 운영체제로 반환해 주는 함수입니다.

데이터 영역이나 스택 영역에 할당되는 메모리의 크기는 컴파일 타임에 결정되어, 프로그램이 실행되는 내내 고정됩니다.

하지만 메모리의 동적 할당으로 힙 영역에 생성되는 메모리의 크기는 런 타임 내내 변화됩니다.

따라서 free() 함수를 사용하여 다 사용한 메모리를 해제해 주지 않으면, 메모리가 부족해지는 현상이 발생할 수 있습니다.

이처럼 사용이 끝난 메모리를 해제하지 않아서 메모리가 부족해지는 현상을 메모리 누수(memory leak)라고 합니다.

free() 함수의 원형은 다음과 같습니다.

##### 원형

#include <stdlib.h>

void free(void *ptr);

free() 함수는 인수로 해제하고자 하는 메모리 공간을 가리키는 포인터를 전달받습니다.

인수의 타입이 void형 포인터로 선언되어 있으므로, 어떠한 타입의 포인터라도 인수로 전달될 수 있습니다.

다음 예제는 크기가 고정된 배열이 아닌 런 타임에 크기가 결정되는 배열을 생성하는 예제입니다.

##### 예제

ptr_arr = (int*) malloc(arr_len * sizeof(int)); // 메모리의 동적 할당  

if (ptr_arr == NULL) // 메모리의 동적 할당이 실패할 경우

{

    printf("메모리의 동적 할당에 실패했습니다.\n");

    exit(1);

}  

printf("동적으로 할당받은 메모리의 초깃값은 다음과 같습니다.\n");

for (i = 0; i < arr_len; i++)

{

    printf("%d ", ptr_arr[i]);

}

free(ptr_arr);       // 동적으로 할당된 메모리의 반환  

[코딩연습 ▶](https://tcpschool.com/examples/tryit/tryC.php?filename=c_memory_malloc_01)

##### 실행 결과

동적으로 할당받은 메모리의 초기값은 다음과 같습니다.

0 0 0