# 2022-12-21

# 3장 PL/SQL 블록 구조

## 익명 블록

기본적으로 QL/SQL 수행 방법으로, 이름을 등록 하지 않고 프로그램 작성 후 바로 수행하기를 원할 경우 익명 블록으로 사용

PL/SQL 블록은 변수 또는 커서 등을 선언하는 DECLARE 절, 실제 프로그램을 실행하는 BEGIN~END 절, 예외 처리하는 EXCEPTION 절로 이루어져 있으며, DECLARE 절과 EXCEPTION절은 생략이 가능하다.

| 구문 | 설명 |
| --- | --- |
| DECLARE | 블록에서 사용 될 변수, 커서, 타입을 선언하는 부분 블록 안에서만 수행될 로컬 프로시저와 함수도 여기에서 정의 할 수 있다. 패키지나 함수, 프로시저에서는 DECLARE절이 필요 없으며 대신 IS절(AS 절) 다음에 기술 가능 |
| BEGIN | 실제 실행시킬 로직을 기술  |
| EXCEPTION | 예외 발생 시 처리 가능한 오류에 대해서 처리하는 로직을 기술하는 부분 |
| END | PL/SQL 블록이 끝났음을 표시 |

```sql
DECLARE
  l_sql varchar2(100);
BEGIN
  FOR i IN 1 .. 10 LOOP
    l_sql := 'CREATE TABLE t' || i || '(id number) ';
    EXECUTE IMMEDIATE l_sql;
  END LOOP;
END;
/
-- 주석 
/* start / end*/ 
```

### 4장 DBMS_OUTPUT 패키지

데이터를 화면에 출력하기 위해서는 DBMS_OUTPUT 패키지를 사용합니다. 보통 디버그를 위해 중간 중간 코드의 상태 값을 확인하거나 최종 결과 값을 확인하기 위해 출력하는 용도로 사용합니다.

화면에 출력하는 건수가 많으면 버퍼 오버플로우(buffer overflow) 에러가 발생할 수 있는데 DBMS_OUTPUT.ENABLE(row 수) 함수를 이용하여 추출 하고자 하는 건수 이상으로 버퍼 크기를 증가 시키거나 또는 DBMS_OUTPUT.ENABLE (buffer_size ⇒ NULL)문을 실행하여 출력 제한이 없도록 지정하면 됩니다.

DBMS_OUTPUT 패키지는 문자열 출력을 위해 대표적으로 아래와 같이 3가지 프로시저를 지원합니다.

| 함수 | 설명 |
| --- | --- |
| PUT_LINE | 문자열을 출력한 후 다음 라인으로 이동합니다. |
| PUT | 문자열을 출력한 후 대기합니다. |
| NEW_LINE | 다음 라인으로 이동합니다. |

```sql
--화면에 결과를 출력하도록 설정
SET SERVEROUTPUT ON

DECLARE
		I_output varchar2(1000);
BEGIN
	--화면에 출력을 100000건으로 제한
	DBMS_OUTPUT.ENABLE(100000);

	--화면 출력에 제한을 두지 않음
	DBMS_OUTPUT.ENABLE(buffer_size=>NULL);

	--데이터 추출 후 다음 라인으로 이동
	DBMS_OYTPUT.PUT_LINE('put_line1');
	
	--데이터 추출 후 대기
	DBMS_OUTPUT.PUT('put1');
	DBMS_OUTPUT.PUT('put2');
	
	--다음 라인으로 이동
	DBMS_OUTPUT.NEW_LINE;
	
	--데이터 추출 후 다음 라인으로 이동
	DBMS_OUTPUT.PUT_LINE('put_line2');
	
	--변수에 담긴 데이터를 출력
	I_output := 'dbms_output test1'
	DBMS_OUTPUT.PUT_LINE('put_line3' || I_output);

END;

/* result */

/* 

put_line1
put1put2
put_line2
put_line3dbms_output test1
*/
```