---
layout: single

title: "Django(장고)기반 애플리케이션 AWS EC2로 배포하는 방법 - [2] AWS EC2 Server"

date: 2020-09-05

categories:
- Django
- AWS


---

# 배포 준비 순서

1. 배포할 Django 프로젝트 준비
   1. 가상 환경 준비
   2. Django 프로젝트 만들기
   3. requirements.txt 만들기
2. **[AWS EC2 Server](#2-aws-ec2-server)**
   1. **[Instance 생성하기](#1-instance-생성하기)**
      1. **[Ubuntu Server 18.04 LTS 서버설정](#1-ubuntu-server-1804-lts-서버설정)**
      2. **[key pair (.pem)](#2-key-pair-pem)**
   2. **[Instance 접속하기](#2-instance-접속하기)**
      1. **[ssh를 이용한 원격 접속](#1-ssh를-이용한-원격-접속)**
   3. **[AWS EC2 서버 세팅](#3-aws-ec2-서버-세팅)**
3. Github 활용
   1. github repository에 Django 프로젝트 업로드
   2. AWS EC2 서버에 git 연동해서 Django 프로젝트 다운
4. uWSGI 연결
   1. runserver 테스트
   2. uWSGI 서버 연결
5. nginx 연결
   1. nginx와 uwsgi 연결

---

## 2. AWS EC2 Server

### 1. Instance 생성하기

Amazon Elastic Compute Cloud(**Amazon EC2**)는 Amazon Web Services(**AWS**) 클라우드에서 확장 가능 컴퓨팅 용량을 제공해줍니다. 

말이 어렵죠? 간단히 말하면 웹 서비스 인터페이스를 사용해 다양한 운영 체제로 인스턴스를 시작 및 네트워크 관리가 가능해집니다.

서비스는 항상 켜져 있어야 하는데 우리의 랩탑이나 데스크탑은 항상 켜져있지 못하는 경우도 생기니 AWS로부터 서버를 빌려서 원격으로 컨트롤해서 배포하려는거예요.



아마존에 로그인 후 Services에서 EC2를 검색해보세요.

![ec2Typing](/images/2021-09-05/ec2Typing.jpg)

오른쪽 상단에서 우리가 임대할 서버의 위치를 정해주세요. 

![region](/images/2021-09-05/region.jpg)

> 저는 가장 가까운 **서울**로 지정했습니다



임대서버 지역 설정 후 **Launch instance**를 눌러주세요

![launchInstance](/images/2021-09-05/launchInstance.jpg)



### 1. Ubuntu Server 18.04 LTS 서버설정

위에서 **다양한 운영체제로 인스턴스를 시작** 가능하다고 하였는데 말 그대로 유저가 원하는 운영체제를 서버에 설치해 줄 수 있어요.

![chooseOS](/images/2021-09-05/chooseOS.jpg)

> 저는 **Ubuntu Server 18.04 LTS** 를 설치하려고 합니다.



**인스턴스 타입**은 일단 무료티어로 선택해 주겠습니다.

**Review and Launch**버튼을 눌러주세요

![instanceType](/images/2021-09-05/instanceType.jpg)



지금까지 우리가 세팅한대로 인스턴스를 생성하겠다고 마지막으로 확인하는 페이지예요.

**Launch**버튼을 눌러주세요

![ReviewInstanceLaunch](/images/2021-09-05/ReviewInstanceLaunch.jpg)



### 2. key pair (.pem)

이제 키페어(key pair)를 설정해 주어야합니다.

새로운 키 페어를 만들어 주기 위해서 **Create a new key pair**를 선택하고 타입은 **RSA**를 선택해 주세요. 키페어 이름은 원하는 대로 정해 주시면 됩니다. 이제 **Download Key pair**를 눌러 생성된 키 페어를 다운로드해주세요.

![keyPair](/images/2021-09-05/keyPair.jpg)

> 저는 키 페어 이름을 **testKeyPair_RSA**로 지정 하였습니다.
>
> 키 페어는 pem 파일로서 다운됩니다.



 **Launch Instance**를 클릭하면 이제 인스턴스가 생성된 것을 확인 할 수 있습니다 :)

![launchStatus](/images/2021-09-05/launchStatus.jpg)



AWS EC2 서버에 원격으로 접속하기 위해서 필요한게 2가지가 있어요

* **SSH** (Secure Shell Protocol)
* **key pair** (.pem)

**SSH**는 네트워크 프로토콜 중 하나로 PC와 PC가 인터넷같은 Public Network를 통해 통신할때 안전하게 통신하기 위해 사용되는 프로토콜입니다. 대표적으로 사용되는 예시는 **데이터 전송**과 **원격 제어**입니다. (우리의 경우에는 **원격 제어**겠죠?)



아까 다운받은 키 페어를 관리해줍시다.

우선 **.ssh**라는 폴더를 만들어 주겠습니다.

![mkdirSSH](/images/2021-09-05/mkdirSSH.jpg)

아까 다운 받은 pem 파일을 **.ssh**폴더로 옮겨줄께요

![moveKeyPair](/images/2021-09-05/moveKeyPair.jpg)

확인해 보니 잘 들어가 있네요.

![pemCheck](/images/2021-09-05/pemCheck.jpg)

**testKeyPair_RSA.pem**에 권한을 주어야하는데 리눅스 계열의 운영체제에서는 **chmod 400 \Users\khsoo\\.ssh\testKeyPair_RSA.pem** 명령어를 타이핑해주면 바로 권한이 주어지지만 윈도우는 다른 방식으로 해주어야합니다. 윈도우스타일로 권한을 주시고 싶으시다면 아래 링크의 방법으로 하시면 됩니다.

[윈도우10 SSH 접속시 PEM파일 퍼미션 에러 해결방법](https://techsoda.net/windows10-pem-file-permission-settings/)

하.지.만. 저는 위의 방식이 매우 귀찮아서 기존에 **git** 설치시 같이 설치되는 **git bash**를 통해 권한을 주었습니다 ㅎㅎ. (이 방법을 추천드립니다)

![gitBashAuth](/images/2021-09-05/gitBashAuth.jpg)



다시 AWS EC2로 돌아가 보면 마지막 페이지에서 **View Instances**를 눌러서 인스턴스가 잘 실행되고 있는지 확인해 봅시다.

![runningInstances](/images/2021-09-05/runningInstances.jpg)

인스턴스의 이름은 **testProject**라고 변경해 주었습니다.

![testProject](/images/2021-09-05/testProject.jpg)



---

## 2. Instance 접속하기

### 1. ssh를 이용한 원격 접속



이제 AWS EC2 서버인 **testProject** 인스턴스에 접속해 볼 차례입니다.

터미널에서 ssh 명령어를 사용해 접속해 보겠습니다.

```
ssh -i [키 페어 경로] [유저이름]@[퍼블릭 DNS 주소]
```

> **키 페어 경로**: 다운받은 pem파일의 경로
>
> **유저이름**: ubuntu 18.04 를 서버로 설치하면 초기 유저이름은 **ubuntu**로 자동 설정됨.
>
> **퍼블릭 DNS 주소**: 아래에서 확인



![InkedinstanceDNS](/images/2021-09-05/InkedinstanceDNS.jpg)

자 이제 명령어를 완성해서 접속해볼까요?

![instanceAccessCmd](/images/2021-09-05/instanceAccessCmd.jpg)



아래 문구가 나오면 **Yes**를 타이핑 해주세요.

![accessYes](/images/2021-09-05/accessYes.jpg)

접속이 정상적으로 완료된걸 확인 할 수 있습니다.

![accessSuccess](/images/2021-09-05/accessSuccess.jpg)

매번 위의 명령어를 이용해 접속하려면 번거롭겠죠?

[ssh 접속 명령어를 간결하게 해주는 설정](https://nerogarret.tistory.com/10)을 참고하면 훨씬 편해집니다!

## 3. AWS EC2 서버 세팅

AWS EC2 서버 접속 후

패키지 정보 업데이트:

```
sudo apt-get update
```

패키지 의존성 검사 및 업그레이드:

```
sudo apt-get dist-upgrade
```

python3 패키지 매니저(pip3) 설치

```
sudo apt-get install python3-pip
```

이제 AWS EC2 서버에 기존의 Django 프로젝트를 올릴 준비가 됐습니다.



참고자료:

* [네로의 다락방](https://nerogarret.tistory.com/45)

* [AWS EC2란?](https://buw.medium.com/aws-ec2%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B4%EB%A9%B0-%EC%99%9C-%EA%B8%B0%EC%97%85%EB%93%A4%EC%9D%B4-ec2%EB%A5%BC-%EC%84%A0%ED%83%9D%ED%95%A0%EA%B9%8C%EC%9A%94-e4c4d6b419b4)

* [SSH란?](https://baked-corn.tistory.com/52)
* [윈도우10 SSH 접속시 PEM파일 퍼미션 에러 해결방법](https://techsoda.net/windows10-pem-file-permission-settings/)

* [ssh 접속 명령어를 간결하게 해주는 설정](https://nerogarret.tistory.com/10)

