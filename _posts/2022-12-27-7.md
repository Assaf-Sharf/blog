---
layout: single
title:  "7장 데이터조작"
---

# 2022-12-27-7

# 7장 데이터 조작

### DML 조작

PL/SQL에도 블록 안에서 제약 없이 INSERT, UPDATE, DELETE MERGE와 같은 DML 문장을 수행 할 수 있다. 동적 SQL 기능을 이용하면 여러 조건에 맞춰 SQL이 동적으로 변경하도록 작성할 수 있다.

```sql
--INSERT
BEGIN
	INSERT INTO emp VALUES(9000,'TEST','CLERK',7934,SYSDATE,1000,0,10);
END;
/

--Update
BEGIN
	UPDATE emp
	SET sal = sal + 100
	WHERE empno = 9000;
END;
/

--Delete
BEGIN
	DELETE FROM emp
	WHERE empno = 9000;
END;
/

--Merge 작업으로 인해 5건은 insert 나머지는 update 수행
BEGIN
	MERGE INTO emp_temp c
			USING emp e ON (e.empno = c.empno)
	WHEN MATCHED THEN
		UPDATE SET
			c.sal = e.sal + 100
		WHEN NOT MATCHED THEN
			INSERT VALUES(e.empno, e.ename, e.job, e.mgr, e.hiredate, e.sal, e.comm, e.deptno);
END;
```

### 커밋

프로그램 변경 사항을 저장하고 모든 Lock을 해제합니다 커밋이 되지 않으면 락이 해제되지 않기 때문에 커밋을 자주 해줘야 성능상 유리하다는 개발자가 있으나, 오라클의 경우 로우 레벨 락킹(Row-Level Locking)을 제공하고 있고 언두(Undo) 세그먼트를 활용한 일관성 읽기를 제공하는 독특한 구조를 가지고 있기 때문에 매번 커밋을 하면 오히려 성능과 안정성에 문제가 발생할 수 있다.

또한 프로시저, 함수, 패키지 내에서 불필요하게 커밋을 수행하면 해당 프로그램을 호출한 메인 프로글매에 문제가 생겨 롤백(rollback)이 될 경우 정합성에 문제가 될 수 있기 때문에 커밋은 꼭 필요할 때만 수행해야 합니다.

### 롤백

롤백(Rollback)은 프로그램 변경 사항을 취소하고 관련된 모든 락을 해제합니다.

### 세이브포인트

프로그램 변경 중 롤백을 수행하면 전체 변경사항이 취소되므로 취소할 필요가 없는 부분까지만 롤백을 수행하도록 세이브포인트(Savepoint)를 지정하여 부분적 롤백을 수행할 수 있습니다

### ROLLBACK TO SAVEPOINT

지정한 세이브포인트 이후의 모든 변경사항을 취소하고 관련된 모든 락을 해제합니다.

### SET TRANSACTION

강력한 트랜잭션 고립화 수준을 설정하기 위해 사용 될 수 있으나, 오라클에서는 일반적인 경우에는 사용할 필요가 없습니다.