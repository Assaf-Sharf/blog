---
title: "[네트워크 기초]패킷의 생성원리"
categories: Network
tag: [Network]
toc: true
author_profile: false
sidebar:
 nav: "docs"
#search: false

---



# 패킷의 생성 원리

TCP라는 요소를 User 모드 어플리케이션 Process가 접근할 수있도록 추상화한 인터페이스가 Socket이다라는걸 계속해서 말해왔다.                    

File의 일종인 Socket이기에 모든 프로그램은 이 File에 읽던지 쓰던지 입출력을 한다. 이때 중요한건 데이터의 단위이다.                

Socket 수준에서 쓰는 데이터의 단위는 Stream이라 한다. Stream이라는 데이터는 시작이 있고 끝은 개발자의 마음대로이다.

트래픽이 TCP로 내려갈 때 stream 단위를 Segment라는 일정단위로 자르고 Segment가 인캡슐레이션되면 Packet이라 부르고 이 Packet이 한번더 인캡슐레이션되면 Frame이라 부른다.

    

    



## **그러면 Packet은 어떻게 생성될까?**

User모드 프로그램을 개발하는, 소위 Socket 프로그래밍을 통해서 자바로든 C++이든 개발하면 Stream 데이터를 네트워크에 보낸다고 Send를 보내는순간 Segmentation 즉 분해가 일어난다.

Packet의 생김새는 길이가 MTU라는 1500byte가량되는데 이 Packet은 크게 둘로 나뉜다 Header 부분과 Payload. 또 이 Header는 다시 IP(L3), TCP(L4) 둘로 나뉜다.

특별한 이유가 없다면 IP도 20byte TCP도 20byte이다. 그렇다면 payload는 1500 -40인 1460이 MSS가 된다. 그러니까 Stream 데이터가 있으면 1460 씩 댕겅댕겅 자르고 payload로 넣어버리고 그앞에 header를 붙인 것이다.

<aside>
⛔ 택배를 보면 송장이 붙어있다 여기서 택배를 Packet 송장이 Header이다

</aside>

보안때문이든 뭐든 Packet이라는 것을 조사하는것을 **DPI(Deep Packet Inspection)**이라한다. (함부로하면 안된다)

Segment라고 하는것은 택배에 들어있는 내용물과 같다. 내용물을 택배박스에 넣는 것을 인캡슐레이션이라고 한다.

Process가 Socket에다가 입출력을 시도하면 메모리에 저장된 Stream형식의 길다란 데이터를 일정단위로 Segment화 한 후에 Packet형식으로 인캡슐레이션되서 생성된다.

Frame이라는 것은 택배박스를 실는 택배차량으로 생각하면 이해하기 쉽다.

> Segment는 L4 수준의 단위
> 
> Packet은 L3 수준의 단위
> 
> Frame은 L2 수준의 단위
