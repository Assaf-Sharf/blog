---
jupyter:
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
  language_info:
    codemirror_mode:
      name: ipython
      version: 3
    file_extension: .py
    mimetype: text/x-python
    name: python
    nbconvert_exporter: python
    pygments_lexer: ipython3
    version: 3.7.12
  nbformat: 4
  nbformat_minor: 4
---

::: {.cell .code execution_count="29" _cell_guid="b1076dfc-b9ad-4769-8c92-a6c4dae69d19" _uuid="8f2839f25d086af736a60e9eeb907d3b93b6e0e5" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:55.294410Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:55.294840Z\",\"iopub.status.idle\":\"2022-10-09T07:13:55.304732Z\",\"iopub.execute_input\":\"2022-10-09T07:13:55.294880Z\",\"shell.execute_reply\":\"2022-10-09T07:13:55.303421Z\"}" trusted="true"}
``` {.python}
# This Python 3 environment comes with many helpful analytics libraries installed
# It is defined by the kaggle/python Docker image: https://github.com/kaggle/docker-python
# For example, here's several helpful packages to load

import numpy as np # linear algebra
import pandas as pd # data processing, CSV file I/O (e.g. pd.read_csv)

# Input data files are available in the read-only "../input/" directory
# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory

import os
for dirname, _, filenames in os.walk('/kaggle/input'):
    for filename in filenames:
        print(os.path.join(dirname, filename))

# You can write up to 20GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using "Save & Run All" 
# You can also write temporary files to /kaggle/temp/, but they won't be saved outside of the current session
```

::: {.output .stream .stdout}
    /kaggle/input/digit-recognizer/sample_submission.csv
    /kaggle/input/digit-recognizer/train.csv
    /kaggle/input/digit-recognizer/test.csv
:::
:::

::: {.cell .code execution_count="30" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:55.310898Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:55.311305Z\",\"iopub.status.idle\":\"2022-10-09T07:13:55.324299Z\",\"iopub.execute_input\":\"2022-10-09T07:13:55.311355Z\",\"shell.execute_reply\":\"2022-10-09T07:13:55.323174Z\"}" trusted="true"}
``` {.python}
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.image as mpimg
import seaborn as sns
%matplotlib inline

np.random.seed(2)

from sklearn.model_selection import train_test_split
from sklearn.metrics import confusion_matrix
import itertools

from keras.utils.np_utils import to_categorical # convert to one-hot-encoding
from keras.models import Sequential
from keras.layers import Dense, Dropout, Flatten, Conv2D, MaxPool2D
from tensorflow.keras.optimizers import RMSprop
from keras.preprocessing.image import ImageDataGenerator
from keras.callbacks import ReduceLROnPlateau


sns.set(style='white', context='notebook', palette='deep')
```
:::

::: {.cell .code execution_count="31" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:55.326430Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:55.327056Z\",\"iopub.status.idle\":\"2022-10-09T07:13:59.681050Z\",\"iopub.execute_input\":\"2022-10-09T07:13:55.327112Z\",\"shell.execute_reply\":\"2022-10-09T07:13:59.680183Z\"}" trusted="true"}
``` {.python}
train = pd.read_csv('../input/digit-recognizer/train.csv')
test = pd.read_csv('../input/digit-recognizer/test.csv')

Y_train = train['label']
X_train = train.drop(labels=['label'] ,axis=1)
del train
g= sns.countplot(Y_train)
Y_train.value_counts()
```

::: {.output .stream .stderr}
    /opt/conda/lib/python3.7/site-packages/seaborn/_decorators.py:43: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
      FutureWarning
:::

::: {.output .execute_result execution_count="31"}
    1    4684
    7    4401
    3    4351
    9    4188
    2    4177
    6    4137
    0    4132
    4    4072
    8    4063
    5    3795
    Name: label, dtype: int64
:::

::: {.output .display_data}
![](vertopal_bcb1a1d6fd0b4f19a8d1f2a71b08ad45/e0f8b5ce671e3b719255c0e2a14ac0fcc0b3e1d3.png)
:::
:::

::: {.cell .code execution_count="32" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:59.682762Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:59.683421Z\",\"iopub.status.idle\":\"2022-10-09T07:13:59.705079Z\",\"iopub.execute_input\":\"2022-10-09T07:13:59.683467Z\",\"shell.execute_reply\":\"2022-10-09T07:13:59.704190Z\"}" trusted="true"}
``` {.python}
X_train.isnull().any().describe()
```

::: {.output .execute_result execution_count="32"}
    count       784
    unique        1
    top       False
    freq        784
    dtype: object
:::
:::

::: {.cell .code execution_count="33" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:59.707205Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:59.707672Z\",\"iopub.status.idle\":\"2022-10-09T07:13:59.726295Z\",\"iopub.execute_input\":\"2022-10-09T07:13:59.707713Z\",\"shell.execute_reply\":\"2022-10-09T07:13:59.725150Z\"}" trusted="true"}
``` {.python}
test.isnull().any().describe()
```

::: {.output .execute_result execution_count="33"}
    count       784
    unique        1
    top       False
    freq        784
    dtype: object
:::
:::

::: {.cell .code execution_count="34" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:59.727715Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:59.727996Z\",\"iopub.status.idle\":\"2022-10-09T07:13:59.835477Z\",\"iopub.execute_input\":\"2022-10-09T07:13:59.728024Z\",\"shell.execute_reply\":\"2022-10-09T07:13:59.834472Z\"}" trusted="true"}
``` {.python}
# Normalize the data
X_train = X_train / 255.0
test = test / 255.0
```
:::

::: {.cell .code execution_count="35" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:59.836523Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:59.836879Z\",\"iopub.status.idle\":\"2022-10-09T07:13:59.843456Z\",\"iopub.execute_input\":\"2022-10-09T07:13:59.836912Z\",\"shell.execute_reply\":\"2022-10-09T07:13:59.842371Z\"}" trusted="true"}
``` {.python}
# Reshape image in 3 dimensions (height = 28px, width = 28px , canal = 1)
X_train = X_train.values.reshape(-1,28,28,1)
test = test.values.reshape(-1,28,28,1)
```
:::

::: {.cell .code execution_count="36" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:59.844901Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:59.845434Z\",\"iopub.status.idle\":\"2022-10-09T07:13:59.860473Z\",\"iopub.execute_input\":\"2022-10-09T07:13:59.845467Z\",\"shell.execute_reply\":\"2022-10-09T07:13:59.859294Z\"}" trusted="true"}
``` {.python}
Y_train = to_categorical(Y_train,num_classes=10)
```
:::

::: {.cell .code execution_count="37" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:59.862112Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:59.862652Z\",\"iopub.status.idle\":\"2022-10-09T07:13:59.871552Z\",\"iopub.execute_input\":\"2022-10-09T07:13:59.862689Z\",\"shell.execute_reply\":\"2022-10-09T07:13:59.870453Z\"}" trusted="true"}
``` {.python}
Y_train
```

::: {.output .execute_result execution_count="37"}
    array([[0., 1., 0., ..., 0., 0., 0.],
           [1., 0., 0., ..., 0., 0., 0.],
           [0., 1., 0., ..., 0., 0., 0.],
           ...,
           [0., 0., 0., ..., 1., 0., 0.],
           [0., 0., 0., ..., 0., 0., 0.],
           [0., 0., 0., ..., 0., 0., 1.]], dtype=float32)
:::
:::

::: {.cell .code execution_count="38" execution="{\"iopub.status.busy\":\"2022-10-09T07:13:59.872880Z\",\"shell.execute_reply.started\":\"2022-10-09T07:13:59.873521Z\",\"iopub.status.idle\":\"2022-10-09T07:14:00.289118Z\",\"iopub.execute_input\":\"2022-10-09T07:13:59.873556Z\",\"shell.execute_reply\":\"2022-10-09T07:14:00.288259Z\"}" trusted="true"}
``` {.python}
random_seed=2
X_train,X_val,Y_train,Y_val = train_test_split(X_train,Y_train,test_size=0.1,random_state=random_seed)
```
:::

::: {.cell .code execution_count="39" execution="{\"iopub.status.busy\":\"2022-10-09T07:14:00.291479Z\",\"shell.execute_reply.started\":\"2022-10-09T07:14:00.291951Z\",\"iopub.status.idle\":\"2022-10-09T07:14:00.504058Z\",\"iopub.execute_input\":\"2022-10-09T07:14:00.291983Z\",\"shell.execute_reply\":\"2022-10-09T07:14:00.503181Z\"}" trusted="true"}
``` {.python}
g= plt.imshow(X_train[0][:,:,0])
```

::: {.output .display_data}
![](vertopal_bcb1a1d6fd0b4f19a8d1f2a71b08ad45/64d88a33cc46d1da5300bded6c8fed544a929e04.png)
:::
:::

::: {.cell .code execution_count="40" execution="{\"iopub.status.busy\":\"2022-10-09T07:22:52.812134Z\",\"shell.execute_reply.started\":\"2022-10-09T07:22:52.812658Z\",\"iopub.status.idle\":\"2022-10-09T07:22:53.031464Z\",\"iopub.execute_input\":\"2022-10-09T07:22:52.812704Z\",\"shell.execute_reply\":\"2022-10-09T07:22:53.030285Z\"}" trusted="true"}
``` {.python}
model = Sequential()
model.add(Conv2D(filters=32,kernel_size=(5,5),padding='Same',activation='relu',input_shape=(28,28,1)))
model.add(Conv2D(filters=32,kernel_size=(5,5),padding='Same',activation='relu'))
model.add(MaxPool2D(pool_size=(2,2)))
model.add(Dropout(0.25))

model.add(Conv2D(filters=64,kernel_size=(3,3),padding='Same',activation='relu'))
model.add(Conv2D(filters=64,kernel_size=(3,3),padding='Same',activation='relu'))
model.add(MaxPool2D(pool_size=(2,2)))
model.add(Dropout(0.25))

model.add(Flatten())
model.add(Dense(256,activation='relu'))
model.add(Dropout(0.5))
model.add(Dense(10,activation='softmax'))
```

::: {.output .stream .stderr}
    2022-10-09 07:22:52.869000: I tensorflow/core/common_runtime/process_util.cc:146] Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads for best performance.
:::
:::

::: {.cell .code execution_count="41" execution="{\"iopub.status.busy\":\"2022-10-09T07:29:49.124123Z\",\"shell.execute_reply.started\":\"2022-10-09T07:29:49.124611Z\",\"iopub.status.idle\":\"2022-10-09T07:29:49.146681Z\",\"iopub.execute_input\":\"2022-10-09T07:29:49.124650Z\",\"shell.execute_reply\":\"2022-10-09T07:29:49.145434Z\"}" trusted="true"}
``` {.python}
optimizer=RMSprop(lr=0.001,rho=0.9,epsilon=1e-08,decay=0.0)
model.compile(optimizer=optimizer,loss='categorical_crossentropy',metrics=['accuracy'])
```

::: {.output .stream .stderr}
    /opt/conda/lib/python3.7/site-packages/keras/optimizer_v2/optimizer_v2.py:356: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
      "The `lr` argument is deprecated, use `learning_rate` instead.")
:::
:::

::: {.cell .code execution_count="42" execution="{\"iopub.status.busy\":\"2022-10-09T07:31:00.084420Z\",\"shell.execute_reply.started\":\"2022-10-09T07:31:00.084823Z\",\"iopub.status.idle\":\"2022-10-09T07:31:00.091181Z\",\"iopub.execute_input\":\"2022-10-09T07:31:00.084856Z\",\"shell.execute_reply\":\"2022-10-09T07:31:00.090207Z\"}" trusted="true"}
``` {.python}
learning_rate_reduction = ReduceLROnPlateau(monitor='val_acc',
                                           patience=3,
                                           verbose=1,factor=0.5,min_lr=0.00001)
epochs=1
batch_size=86
```
:::

::: {.cell .code}
``` {.python}
```
:::
