---
title:  "Flask 템플릿"
excerpt: " Flask 공부"

categories:
  - Python
tags:
  - [Python, flask]

toc: true
toc_sticky: true

breadcrumbs: true
 
date: 2023-09-12
last_modified_at: 2023-09-12
---

## 세션이란?
쿠기 : 유저컴퓨터에 저장됨
세션 : 구축한 서버에 저장됨

서버인프라 그림에서 복수의 유저들의 request들을 load balance에서 받아서 각 웹 or application server에 랜덤분배해준다.(균등하게) 그렇다면 해당 메모리가 각 서버에 저장되면 안되기에 별도의 in-memory, database를 빼서 공통으로 쓰여진다.(라우팅하게끔 되어있다)

## 메모리로 로그인재현
- v1.0.7

- 세션 컨텍스트 이용
- 데이터 클래스로 유저 모델 만들기
- 메모리로 기능 재현
- index.html에 유저 아이디 노출
- 개발자도구 세션네임 체크
- flask config (SESSION_COOKIE_NAME)

- 레퍼런스
[flask config](https://flask.palletsprojects.com/en/1.1.x/config/#SESSION_COOKIE_NAME)

일단 데이터클래스를 이용해보자.
auth_route.py를 열어주자. 
  그리고 User class를 만들어주자.
  그러면 개발서버가 뜰때 해당 user가 뜨게 된다.
  해당 User class를 임시 db로 사용해서
  로그인했을때 user_id 없을때에 해당하는 page를 구성했다.
  (session context 추가함)

index.html에서도 session context 접근할수 있다.
```
{% block body -%}
<h1>hello world!!!!! {{ session.get('use r_id') }}</h1>
{%- endblock %}
```

그다음 auth_route.py에서 logout 함수를 완료하자.
logout은 세션의 user_id만 없애주면 된다.
```
def logout():
    session.pop('user_id',None) # None은 만약 user_id 없을경우!
    return redirect(url_for(f'{NAME}.login'))

```

이제 register함수를 완료하자.
  request context추가 : register url로 들어온거로 redirect 해준다는 뜻. 즉 request.path = registerForm()이다. 즉 유입된 path와 같다. 

지금까지 한거는 메모리에 USERS=[] 넣어서 한것!
만약 서버 껐다 키면 메모리는 초기화되서 로그인안된다.
그래서 나중에 DB에 넣어서 진행할것이다.

개발자도구의 application부분을 보면, 
HTTP는 서로의 상태를 모른다. 항상 쿠키에 저장되어 있는 정보를 서버에 보내주고(http request할때)  그정보를 조회해서 세션에 있는, 즉 서버 메모리에 있는 세션아이디와 비교하는 로직이 있다.그래서 로그인상태가 유지되는 것이다. 즉, 쿠키를 날리게 되면 로그인이 풀릴수 있다. 

init.py에 가보자.
    app.config['SECRET_KEY'] = 'secretkey'
    이렇게 secretkey를 넣어줬자나. 넣어줬기 때문에 해당 session이 암호화되어서 들어간다고 보면 된다.
  
이제 session으로 들어가는데 우리만의 고유의 session name으로 바꿔보자.
```
    app.config['SESSION_COOKIE_NAME'] = 'googlekaap'
```
이러한 config정보는 flask 공식정보에 잘나왔으니 참고하자!

## 로그인기능구현 : werkzeug로 패스워드 암호화
- v1.0.8
- werkzeug 시큐리티로 패스워드 암호화하기
- 암호화된 패스워드 비교하기

- 비슷한 종류의 오픈소스
[암호화 오픈소스 예시](https://flask-bcrypt.readthedocs.io/en/latest/)


auth_route.py에서 작업을 하자
  로그인만드는 부분부터 회원가입하는 부분에 암호화모듈을 반영하자.

[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}
 

