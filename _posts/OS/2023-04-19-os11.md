---
layout: single
title: "[OS] 운영체제(4장) 쓰레드 - 2"
categories: os
tag: [cs, os]
toc: true
---

# 쓰레드

## <span style="color:blue">4. Thread 라이브러리</span>

thread를 생성하고 관리하기 위한 API 제공

### thread 라이브러리 구현

user-level library : 완전히 user space에서 구현
 - library 함수 호출은 user space에서의 함수 호출로 이어짐
kernel-level library : library의 코드와 데이터가 kernel space에 존재
 - library 함수 호출은 커널에 대한 system call 호출로 이어짐

### 주요 Thread libraries

1. POSIX Pthreads: user- or kernel-level library
2. Windows thread: kernel-level library
3. Java Thread: Java thread API → 호스트 시스템에서 사용 가능한 thread library로 구현

### <span style="color:skyblue">Pthreads</span>

- Thread 생성 및 동기화를 위한 POSIX 표준 API (IEEE 1003.1c)
  - thread library의 동작에 대한 명세(specification)
  - 구현방법을 명시한 것은 아님
  - UNIX 계열 OS에서 일반적으로 제공됨 (Solaris, Linux, Mac OS X)
- Pthread library 함수
  - pthread_create() - thread 생성
  - pthread_join() – 다른 thread 종료를 기다림
  - pthread_exit() – thread 종료
  - pthread_attr_init() – thread attribute를 default 값으로 초기화
  - …

## <span style="color:blue">5. 묵시적 쓰레딩</span>

- Thread 생성과 관리를 응용 프로그램 개발자가 아닌 **compiler와 runtime library**에게 맡기는 것
- 멀티코어 병렬 처리를 사용하는 프로그램 설계에 사용

### 컴파일러에서 멀티 쓰레딩 지원

- Open MP
- GCD (Grand Central Dispatch)

### 멀티 쓰레딩 관리 방법

- Thread Pool

### <span style="color:skyblue">Thread Pools</span>

#### Multithreaded server에서의 잠재적 문제점

- thread 생성 오버헤드 : 요청마다 thread를 생성하는 데 시간이 소요됨
- thread 수가 증가에 따른 자원 고갈 가능성 → thread 수에 제한이 필요

#### 해결책 → Thread pool

- 프로세스를 시작할 때에 일정한 수의 thread들을 thread pool에 미리 생성하여 대기함
- 요청을 받을 때마다 pool에 있는 하나의 thread를 깨워서 사용

#### 장점

빠른 속도
- 새 thread 생성 소요시간보다 기존 thread로 서비스하는 것이 더 빠름
pool의 크기로 동시 존재 thread 수 제한 가능
- 병렬 처리 능력 고려
task 생성 방법을 task에서 분리하면 task실행을 다른 방식으로 할 수 있음
- 주기적 실행, 일정시간 후 실행 등

### <span style="color:skyblue">OpenMP(Open Multi-Processing)</span>

- C, C++, Fortran 컴파일러의 directive와 API로 공유 메모리 환경에서의 병렬
프로그래밍 지원
- 병렬 영역에 대하여 코어 개수의 thread를 생성하여 병렬처리

### <span style="color:skyblue">GCD(Grand Central Dispatch)
</span>

- Apple Mac OS X, iOS 운영체제에서 지원
- C/C++ 언어의 확장, API, runtime library로 제공
- 병렬 섹션을 구분하여 쓰레딩 관리 지원 – 블록 표시 ^{ }
ˆ{ printf("I am a block"); }{: .notice--primary}
- 블록들은 dispatch queue에 넣고, queue에서 제거될 때에
thread pool에서 가용 thread에 선택하여 할당함

## <span style="color:blue">.6 쓰레드 관련 이슈</span>

### fork(), exec() 시스템 호출

thread에서 fork()를 호출 할 때의 동작은?

### 두 가지 fork() 구현 방법 - 응용 프로그램이 선택

- process의 모든 thread들을 복제 : fork - no exec의 경우에 사용
   - 생성된 프로세스는 multi-threaded
- 해당 thread만 복제 : fork - exec의 경우에 사용
   - 생성된 프로세스는 single threaded

![image](https://user-images.githubusercontent.com/100071667/232953309-9f047e72-b686-437f-9ab2-3844c98b52f7.png){: width="80%" height="70%" .align-center}

### <span style="color:skyblue">UNIX에서의 Signal handling </span>

#### Signal