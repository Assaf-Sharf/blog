---

layout: single
title: "영속성 관리 - 내부 동작 방식"
---

## **영속성 컨텍스트 1**
엔티티 매니저 팩토리와 엔티티 매니저
<img width="475" alt="image" src="https://user-images.githubusercontent.com/114092152/230809641-5d5f6310-632e-4a20-8b27-de144dcbfbd1.png">
- 웹 어플리케이션이 구동하는 시점에 `EntityManagerFactory` 를 생성하여 가지고 있으며, 사용자의 요청이 있을 때 `EntityManager`를 생성하여 `Connection Pool`을 사용해서 DB를 핸들링

### **영속성 컨텍스트란**
- 엔티티를 영구 저장하는 환경
- EntityManager.persist(entity);
<br> -> DB에 저장한다기보다는 영속성 컨텍스트를 통해 엔티티를 영속화 한다는 의미
<br> -> 영속성 컨텍스트에 엔티티를 저장
- 영속성 컨텍스트는 논리적인 개념
- 눈에 보이지 X
- 엔티티 매니저를 통해서 영속성 컨텍스트에 접근
- 엔티티 매니저와 영속성 컨텍스트가 1:1
<img width="350" alt="image" src="https://user-images.githubusercontent.com/114092152/230810612-a78540e0-b1fa-466b-af69-3b4128365663.png">

### **엔티티의 생명주기**
<img width="350" alt="image" src="https://user-images.githubusercontent.com/114092152/230810819-048b206e-8d9a-4337-b179-af1c38f57366.png">

- 비영속 (new/transient)
<br> : 영속성 컨텍스트와 전혀 관계가 없는 __새로운__ 상태 
- 영속 (managed)
<br> : 영속성 컨텍스트에 **관리**되는 상태 
- 준영속 (detached)
<br> : 영속성 컨텍스트에 저장되었다가 **분리**된 상태 
- 삭제 (removed)
<br> : **삭제**된 상태

## **영속성 컨텍스트 2**
### **비영속**
- JPA에 관계없이 객체 생성만 된 상태
<img width="450" alt="image" src="https://user-images.githubusercontent.com/114092152/230811591-c04e9c4f-18f2-473e-b843-9baae81926fe.png">

```java
//객체를 생성한 상태(비영속)
Member member = new Member();
member.setId("member1");
member.setName("회원1");
```

### **영속**
<img width="304" alt="image" src="https://user-images.githubusercontent.com/114092152/230811817-743037af-7e2d-48cd-a409-86214dacc914.png">

```java
//객체를 생성한 상태(비영속)
Member member = new Member();
member.setId("member1");
member.setName("회원1");

EntityManager em = emf.createEntityManager();
em.getTransaction().begin();

//객체를 저장한 상태(영속)
em.persist(member);
```








