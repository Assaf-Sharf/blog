---
layout: single
title: Chapter 32 스택 프레임
date: 2023-12-04 18:55:47 +09:00
categories:
  - Language
tags:
  - C
excerpt: 스택 프레임에 관한 글입니다.
toc: true
---

# 1 스택 프레임(stack frame)

>메모리의 스택(stack) 영역은 함수의 호출과 관계되는 지역 변수와 매개변수가 저장되는 영역이다.
스택 영역은 함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸한다.

>함수가 호출되면 스택에는 함수의 매개변수, 
>호출이 끝난 뒤 돌아갈 반환 주소값, 
>함수에서 선언된 지역 변수 등이 저장된다.

- 스택 프레임(stack frame)

>스택 프레임(stack frame)이란 스택 영역에 차례대로 저장되는 함수의 호출 정보를 의미한다.

>이러한 스택 프레임 덕분에 함수의 호출이 모두 끝난 뒤에, 
>해당 함수가 호출되기 이전 상태로 되돌아갈 수 있다.

## 1.1 스택 프레임의 동작 방식

- 예제

```c
int main(void)
{
    func1();  // func1() 호출
    return 0;
}

void func1()
{
    func2();  // func2() 호출
}

void func2()
{

}
```

>다음 그림은 위 예제 코드에서 함수 호출에 의한 스택 프레임의 변화를 보여주고 있다.

![image](https://github.com/EunChong999/EunChong999/assets/136239807/591611af-d2c2-45bd-bd49-f87b9b55aa6f)

![image](https://github.com/EunChong999/EunChong999/assets/136239807/5d0e8a98-fe8e-4538-b9da-55e58059f317)

Step 1. 프로그램이 실행되면, 가장 먼저 main() 함수가 호출되어 main() 함수의 스택 프레임이 스택에 저장된다.

Step 2. func1() 함수를 호출하면 해당 함수의 매개변수, 반환 주소값, 지역 변수 등의 스택 프레임이 스택에 저장된다.

Step 3. func2() 함수를 호출하면 해당 함수의 스택 프레임이 추가로 스택에 저장된다.

Step 4. func2() 함수의 모든 작업이 완료되어 반환되면, func2() 함수의 스택 프레임만이 스택에서 제거된다.

Step 5. func1() 함수의 호출이 종료되면, func1() 함수의 스택 프레임이 스택에서 제거된다.

Step 6. main() 함수의 모든 작업이 완료되면, main() 함수의 스택 프레임이 스택에서 제거되면서 프로그램이 종료된다.

>이처럼 스택은 가장 나중에 저장된 데이터가 가장 먼저 인출되는 방식으로 동작한다.
이러한 방식을 후입선출(LIFO, Last-In First-Out) 방식이라고 한다.
이때 스택은 푸시(push) 동작으로 데이터를 저장하고, 팝(pop) 동작으로 데이터를 인출한다.

#### 스택 오버플로우(stack overflow)

>함수의 재귀 호출이 무한히 반복되면, 
>해당 프로그램은 스택 오버플로우(stack overflow)에 의해 종료된다.

>만약 재귀 호출이 무한히 반복되면, 
>위 그림에서 Step 3 이후로는 재귀 호출에 의한 스택 프레임이 계속해서 쌓여만 갈 것이다.
이렇게 스택의 모든 공간을 다 차지하고 난 후 더 이상의 여유 공간이 없을 때 또 다시 스택 프레임을 저장하게 되면, 해당 데이터는 스택 영역을 넘어가서 저장되게 된다.

![image](https://github.com/EunChong999/EunChong999/assets/136239807/b2254cc1-87f8-41b8-8ad6-de08d10904df)

>이렇게 해당 스택 영역을 넘어가도 데이터가 저장될 수 있으면, 
>해당 프로그램은 오동작을 하게 되거나 보안상의 크나큰 취약점을 가지게 된다.
따라서 C 언어에서는 실행 중인 프로그램에서 스택 오버플로우가 발생하면, 
에러를 발생하고 곧바로 강제 종료시킨다.
