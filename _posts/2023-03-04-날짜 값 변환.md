---
title: "Spring MVC : 날짜 값 변환"
categories:
  - Spring
toc: true
toc_label: "목차"
#toc_icon:
toc_sticky: true
#last_modified_at:
---
## 1. 날짜를 이용한 회원 검색 기능
회원 가입 일자를 기준으로 검색하는 기능을 구현하면서 몇 가지 스프링 MVC의 특징을 설명할 것이다. 이를 위해 MemberDao 클래스에 selectByRegdate() 메서드를 추가한다.

```java
public class MemberDao {
  private JdbcTemplate jdbcTemplate;

  public MemberDao(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
  }
  ...

  public List<Member> selectByRegdate(
          LocalDateTime from, LocalDateTime to) {
    
    List<Member> results = jdbcTemplate.query(
      "select * from MEMBER where REGDATE between ? and ? "
      + "order by REGDATE desc;",
      new RowMapper<Member>(){
        @Override
        public Member mapRow(ResultSet rs, int rowNum) throws SQLException {
          Member member = new Member(
            rs.getString("EMAIL"),
            rs.getString("PASSWORD"),
            rs.getString("NAME"),
            rs.getTimestamp("REGDATE").toLocalDateTime());
          member.setId(rs.getLong("ID"));
          return member;
        }
      }, from, to);
    return results;
  }
}
```
selectByRegdate() 메서드는 REGDATE 값이 파라미터로 전달받은 from과 to 사이에 있는 Member 목록을 구한다. 이 메서드를 이용해서 특정 기간 동안에 가입한 회원 목록을 보여준느 기능을 구현할 것이다.

## 2. 커맨드 객체 Date 타입 프로퍼티 변환 처리 : @DateTimeFormat
회원이 가입한 일시를 기준으로 회원을 검색하기 위해 시작 시간 기준과 끝 시간 기준을 파라미터로 전달받는다고 하자. 검색 기준 시간을 표현하기 위해 다음의 커맨드 클래스를 구현한다.

```java
import java.time.LocalDateTime;

public class ListCommand {
  private LocalDateTime from;
  private LocalDateTime to;

  public LocalDateTime getFrom(){
    return from;
  }
  public void setFrom(LocalDateTime from){
    this.from = from;
  }
  public LocalDateTime getTo(){
    return to;
  }
  public void setTo(LocalDateTime to){
    this.to = to;
  }
}
```
검색을 위한 입력 폼은 다음처럼 이름이 from과 to인 <imput> 태그를 정의한다.
```jsp
<input type="text" name="from"/>
<input type="text" name="to"/>
```

여기서 문제는 < input>에 입력한 문자열을 LocalDateTime 타입으로 변환해야 한다는 것이다, < input>에 2018년 3월 1일 오후 3시를 표현하기 위해 "2018030115"로 입력한다고 해 보자. "2018030115" 문자열을 알맞게 LocalDateTime 타입으로 변환해야 한다.

> 스프링은 Long이나 int와 같은 기본 데이터 타입으로의 변환은 기본적으로 처리해 주지만 LocalDateTime 타입으로의 변환은 추가 설정이 필요하다. 다행히 설정이 복잡하지 않다.\
앞서 작성한 ListCommand 클래스의 두 필드에 @DateTimeFormat 애노테이션을 적용하면 된다.

```java
import org.springframework.format.annotation.DateTimeFormat;

public class ListCommand {

  @DateTimeFormat(pattern = "yyyyMMddHH")
  private LocalDateTime from;
  @DateTimeFormat(pattern = "yyyyMMddHH")
  private LocalDateTime to;
  
  ...
}
```
커맨드 객체에 @DateTimeFormat 애노테이션이 적용되어 있으면 @DateTimeFormat에서 지정한 형식을 이용해서 문자열을 LocalDateTime 타입으로 변환한다. 예를 들어 pattern 속성값으로 "yyyyMMddHH"을 주었는데 이 경우 "2018030115"의 문자열을 "2018년 3월 1일 15시" 값을 갖는 LocalDateTime 객체로 변환해준다.

## Ref.
- 최범균, 스프링프로그래밍입문5, 가메출판사.
