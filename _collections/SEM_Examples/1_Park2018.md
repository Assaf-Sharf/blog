---
layout: single
author_profile: true
title: "md Progression of Dengue illness phenotype - data from Park et al 2018"
category: SEM
shorttitle: "SEM_Park2018"
shortdesc: "Modelling progression of the dengue illness phenotype. Replication of the SEM analysis presented in 
Park, S., Srikiatkhachorn, A., Kalayanarooj, S., Macareo, L., Green, S., Friedman, J. F., & Rothman, A. L. (2018)."
Method: "CB-SEM using R's `Lavaan` Package. The visualization was
generated using and `semPlots`'s Package."
Case: "a partial replication of an intermediary step in modelling
progression of the dengue illness phenotype."
Datafrom: "Park S, Srikiatkhachorn A, Kalayanarooj S, Macareo L, Green
S, Friedman JF, et al. (2018). Use of structural equation models to
predict dengue illness phenotype. PLoS Negl Trop Dis 12 (10): e0006799.
<https://doi.org/10.1371/journal>. pntd.0006799"
excerpt: "Some code examples using R"
header:
  overlay_color: "#333"
permalink: /collections/SEM_Examples/1_Park2018
date: "2022-05-27"
output: 
  html_document:
    keep_md: true
editor_options: 
  markdown: 
    wrap: 72
---


```r
library(dplyr)
library(lavaan)
```

```r
library(semPlot)
```

# Objective

Modelling progression of the dengue illness phenotype. Replication of the SEM analysis presented in:

Park, S., Srikiatkhachorn, A., Kalayanarooj, S., Macareo, L., Green, S., Friedman, J. F., & Rothman, A. L. (2018). Use of structural equation models to predict dengue illness phenotype. PLoS Neglected Tropical Diseases, 12(10), 1--14. <https://doi.org/10.1371/journal.pntd.0006799>

The paper was worried about the evolution of the Dengue virus (DENV) infection, which, in severe cases, lead to Dengue Hemorrhagic Fever (DHF), characterized by fever, plasma leakage, bleeding diathesis and trombocytopenia. Platelet counts and hepatic parameters like ALT were monitored in three moments of time to model the progression of the phenotype in dengue illness.

# Data acquisition


```r
library(openxlsx)
data<-read.xlsx("Park2018.xlsx")
str(data)
```

```
## 'data.frame':	257 obs. of  21 variables:
##  $ age2        : chr  "12-13" "4-5" "4-5" "8-9" ...
##  $ sex         : num  1 1 2 2 1 1 1 1 2 2 ...
##  $ dengue      : num  1 1 0 1 1 0 1 1 1 1 ...
##  $ dhf         : num  1 0 0 0 0 0 0 0 0 0 ...
##  $ dhf34       : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ ast_m3      : num  25 38 27 167 29 39 32 48 36 35 ...
##  $ alt_m3      : num  10 14 9 109 13 15 10 23 18 16 ...
##  $ wbc_m3      : num  3600 7200 9200 2200 9500 8000 5200 5000 2800 6000 ...
##  $ lymph_m3    : num  16 21 13 34 7 21 16 18 37 11 ...
##  $ albumin_m3  : num  4.5 5.6 4.6 4.8 5 5.9 4.6 3.9 4 4.2 ...
##  $ max_hct_m3  : num  42.5 38 37 40 38 40 42.5 39 38 40 ...
##  $ platelets_m3: num  271000 272000 216000 227000 204000 287000 266000 307000 206000 273000 ...
##  $ tourn_no_m3 : num  21 21 10 21 5 8 21 4 6 4 ...
##  $ ast_m1      : num  53 36 26 248 34 35 43 43 240 97 ...
##  $ alt_m1      : num  15 14 11 174 14 11 9 24 126 28 ...
##  $ wbc_m1      : num  2300 5100 3800 1600 6500 7300 2800 3800 600 3300 ...
##  $ lymph_m1    : num  32 60 41 39 61 45 24 35 42 32 ...
##  $ albumin_m1  : num  4.3 4.6 3.7 4.5 4.9 4.9 3.9 3.8 4.4 4.5 ...
##  $ max_hct_m1  : num  43 39 37 40 36 37 41 39 38 45 ...
##  $ platelets_m1: num  73000 263000 200000 116000 163000 262000 168000 147000 180000 106000 ...
##  $ tourn_no_m1 : num  21 21 0 21 2 4 21 20 14 21 ...
```

```r
library(stringr)
data$age_t<-as.numeric(str_extract(data$age2, "(\\d)+(?=-)"))
```

# SEM

**Original method:** SEM using Mplus 8 statistical software. SEM parameters were estimated using the weighted least squares means and variances adjusted estimator with the theta parameterization

**Method applied in this analysis:** CB-SEM with MLR estimator in R's package `Lavaan`.


```r
library(lavaan)
model="
  dhf~ast_m1+alt_m1+wbc_m1+lymph_m1+albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1+age_t
  ast_m1~alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  alt_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  wbc_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  lymph_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  albumin_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  max_hct_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  platelets_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  tourn_no_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  
  ast_m3~age_t
  alt_m3~age_t
  wbc_m3~age_t
  lymph_m3~age_t
  albumin_m3~age_t
  max_hct_m3~age_t
  platelets_m3~age_t
  tourn_no_m3~age_t
  
  # covariances
  ast_m1~~alt_m1+wbc_m1+lymph_m1+albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1
  alt_m1~~wbc_m1+lymph_m1+albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1
  wbc_m1~~lymph_m1+albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1
  lymph_m1~~albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1
  albumin_m1~~max_hct_m1+platelets_m1+tourn_no_m1
  max_hct_m1~~platelets_m1+tourn_no_m1
  platelets_m1~~tourn_no_m1
  
  ast_m3~~alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3
  alt_m3~~wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3
  wbc_m3~~lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3
  lymph_m3~~albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3
  albumin_m3~~max_hct_m3+platelets_m3+tourn_no_m3
  max_hct_m3~~platelets_m3+tourn_no_m3
  platelets_m3~~tourn_no_m3
  "
```


```r
fit=sem(model=model, data=data,std.ov=TRUE,estimator="MLR")
summary(fit)
```

```
## lavaan 0.6-11 ended normally after 68 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                       161
##                                                       
##   Number of observations                           257
##                                                       
## Model Test User Model:
##                                                Standard      Robust
##   Test Statistic                                111.478      36.832
##   Degrees of freedom                                  9           9
##   P-value (Chi-square)                            0.000       0.000
##   Scaling correction factor                                   3.027
##        Yuan-Bentler correction (Mplus variant)                     
## 
## Parameter Estimates:
## 
##   Standard errors                             Sandwich
##   Information bread                           Observed
##   Observed information based on                Hessian
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(>|z|)
##   dhf ~                                               
##     ast_m1            0.071    0.112    0.628    0.530
##     alt_m1            0.088    0.104    0.847    0.397
##     wbc_m1           -0.004    0.056   -0.074    0.941
##     lymph_m1         -0.092    0.056   -1.639    0.101
##     albumin_m1        0.026    0.058    0.439    0.661
##     max_hct_m1        0.198    0.061    3.254    0.001
##     platelets_m1     -0.218    0.064   -3.376    0.001
##     tourn_no_m1       0.158    0.058    2.717    0.007
##     age_t            -0.013    0.022   -0.591    0.555
##   ast_m1 ~                                            
##     alt_m3            0.289    0.168    1.723    0.085
##     wbc_m3           -0.094    0.045   -2.099    0.036
##     lymph_m3         -0.109    0.053   -2.046    0.041
##     albumin_m3       -0.078    0.039   -1.993    0.046
##     max_hct_m3        0.040    0.111    0.362    0.717
##     platelets_m3     -0.186    0.080   -2.328    0.020
##     tourn_no_m3       0.042    0.040    1.048    0.295
##     age_t            -0.038    0.022   -1.721    0.085
##   alt_m1 ~                                            
##     ast_m3           -0.027    0.108   -0.247    0.805
##     alt_m3            0.606    0.221    2.743    0.006
##     wbc_m3           -0.085    0.041   -2.064    0.039
##     lymph_m3         -0.040    0.040   -0.994    0.320
##     albumin_m3       -0.099    0.042   -2.379    0.017
##     max_hct_m3        0.051    0.069    0.733    0.463
##     platelets_m3     -0.111    0.047   -2.348    0.019
##     tourn_no_m3       0.026    0.034    0.769    0.442
##     age_t             0.003    0.014    0.182    0.856
##   wbc_m1 ~                                            
##     ast_m3            0.274    0.089    3.078    0.002
##     alt_m3           -0.149    0.054   -2.752    0.006
##     wbc_m3            0.777    0.056   13.969    0.000
##     lymph_m3          0.129    0.039    3.318    0.001
##     albumin_m3       -0.136    0.047   -2.914    0.004
##     max_hct_m3        0.041    0.044    0.924    0.355
##     platelets_m3      0.101    0.047    2.139    0.032
##     tourn_no_m3       0.002    0.042    0.038    0.970
##     age_t            -0.014    0.014   -1.028    0.304
##   lymph_m1 ~                                          
##     ast_m3           -0.066    0.116   -0.566    0.571
##     alt_m3            0.025    0.085    0.291    0.771
##     wbc_m3           -0.222    0.051   -4.343    0.000
##     lymph_m3          0.292    0.068    4.301    0.000
##     albumin_m3        0.060    0.056    1.066    0.286
##     max_hct_m3       -0.094    0.059   -1.601    0.109
##     platelets_m3     -0.006    0.066   -0.093    0.926
##     tourn_no_m3      -0.067    0.058   -1.155    0.248
##     age_t            -0.055    0.022   -2.541    0.011
##   albumin_m1 ~                                        
##     ast_m3           -0.257    0.087   -2.964    0.003
##     alt_m3            0.098    0.068    1.437    0.151
##     wbc_m3           -0.030    0.064   -0.477    0.633
##     lymph_m3          0.047    0.061    0.773    0.439
##     albumin_m3        0.491    0.058    8.475    0.000
##     max_hct_m3       -0.051    0.062   -0.824    0.410
##     platelets_m3      0.110    0.057    1.923    0.054
##     tourn_no_m3      -0.059    0.051   -1.148    0.251
##     age_t             0.019    0.022    0.884    0.377
##   max_hct_m1 ~                                        
##     ast_m3           -0.169    0.131   -1.290    0.197
##     alt_m3            0.101    0.081    1.246    0.213
##     wbc_m3           -0.109    0.057   -1.912    0.056
##     lymph_m3         -0.142    0.049   -2.910    0.004
##     albumin_m3       -0.070    0.044   -1.576    0.115
##     max_hct_m3        0.506    0.064    7.870    0.000
##     platelets_m3     -0.075    0.051   -1.465    0.143
##     tourn_no_m3      -0.030    0.049   -0.603    0.547
##     age_t             0.047    0.019    2.482    0.013
##   platelets_m1 ~                                      
##     ast_m3            0.017    0.118    0.140    0.888
##     alt_m3           -0.068    0.063   -1.091    0.275
##     wbc_m3            0.270    0.070    3.845    0.000
##     lymph_m3          0.074    0.054    1.376    0.169
##     albumin_m3       -0.030    0.048   -0.635    0.525
##     max_hct_m3        0.004    0.048    0.076    0.939
##     platelets_m3      0.558    0.060    9.332    0.000
##     tourn_no_m3      -0.053    0.045   -1.172    0.241
##     age_t            -0.004    0.018   -0.251    0.802
##   tourn_no_m1 ~                                       
##     ast_m3            0.075    0.070    1.078    0.281
##     alt_m3            0.033    0.052    0.630    0.529
##     wbc_m3           -0.123    0.050   -2.468    0.014
##     lymph_m3         -0.136    0.062   -2.198    0.028
##     albumin_m3       -0.075    0.052   -1.439    0.150
##     max_hct_m3        0.019    0.070    0.263    0.793
##     platelets_m3     -0.043    0.061   -0.718    0.473
##     tourn_no_m3       0.484    0.054    8.933    0.000
##     age_t             0.029    0.018    1.605    0.109
##   ast_m3 ~                                            
##     age_t            -0.011    0.019   -0.598    0.550
##   alt_m3 ~                                            
##     age_t             0.032    0.018    1.788    0.074
##   wbc_m3 ~                                            
##     age_t            -0.059    0.017   -3.523    0.000
##   lymph_m3 ~                                          
##     age_t            -0.110    0.019   -5.639    0.000
##   albumin_m3 ~                                        
##     age_t             0.022    0.019    1.127    0.260
##   max_hct_m3 ~                                        
##     age_t             0.109    0.019    5.618    0.000
##   platelets_m3 ~                                      
##     age_t            -0.087    0.020   -4.422    0.000
##   tourn_no_m3 ~                                       
##     age_t             0.037    0.020    1.866    0.062
## 
## Covariances:
##                    Estimate  Std.Err  z-value  P(>|z|)
##  .ast_m1 ~~                                           
##    .alt_m1            0.523    0.195    2.682    0.007
##    .wbc_m1           -0.048    0.050   -0.959    0.338
##    .lymph_m1          0.009    0.092    0.098    0.922
##    .albumin_m1        0.151    0.126    1.199    0.230
##    .max_hct_m1       -0.067    0.046   -1.477    0.140
##    .platelets_m1     -0.045    0.023   -1.943    0.052
##    .tourn_no_m1       0.029    0.033    0.864    0.388
##  .alt_m1 ~~                                           
##    .wbc_m1           -0.033    0.030   -1.083    0.279
##    .lymph_m1         -0.006    0.060   -0.108    0.914
##    .albumin_m1        0.113    0.065    1.752    0.080
##    .max_hct_m1       -0.036    0.033   -1.094    0.274
##    .platelets_m1     -0.033    0.023   -1.403    0.160
##    .tourn_no_m1       0.029    0.029    0.985    0.325
##  .wbc_m1 ~~                                           
##    .lymph_m1         -0.108    0.039   -2.784    0.005
##    .albumin_m1        0.013    0.035    0.360    0.719
##    .max_hct_m1        0.011    0.031    0.365    0.715
##    .platelets_m1      0.113    0.025    4.532    0.000
##    .tourn_no_m1      -0.016    0.028   -0.580    0.562
##  .lymph_m1 ~~                                         
##    .albumin_m1        0.013    0.046    0.285    0.776
##    .max_hct_m1        0.030    0.043    0.692    0.489
##    .platelets_m1     -0.013    0.038   -0.335    0.738
##    .tourn_no_m1      -0.106    0.040   -2.655    0.008
##  .albumin_m1 ~~                                       
##    .max_hct_m1        0.008    0.047    0.167    0.867
##    .platelets_m1      0.141    0.038    3.727    0.000
##    .tourn_no_m1      -0.018    0.041   -0.425    0.671
##  .max_hct_m1 ~~                                       
##    .platelets_m1     -0.106    0.042   -2.492    0.013
##    .tourn_no_m1       0.099    0.042    2.374    0.018
##  .platelets_m1 ~~                                     
##    .tourn_no_m1      -0.054    0.037   -1.478    0.139
##  .ast_m3 ~~                                           
##    .alt_m3            0.742    0.276    2.690    0.007
##    .wbc_m3           -0.213    0.043   -4.985    0.000
##    .lymph_m3          0.087    0.041    2.126    0.034
##    .albumin_m3       -0.186    0.081   -2.289    0.022
##    .max_hct_m3        0.103    0.151    0.687    0.492
##    .platelets_m3     -0.206    0.102   -2.011    0.044
##    .tourn_no_m3       0.122    0.058    2.106    0.035
##  .alt_m3 ~~                                           
##    .wbc_m3           -0.130    0.035   -3.768    0.000
##    .lymph_m3          0.020    0.042    0.480    0.631
##    .albumin_m3       -0.174    0.081   -2.146    0.032
##    .max_hct_m3        0.084    0.079    1.056    0.291
##    .platelets_m3     -0.105    0.058   -1.815    0.070
##    .tourn_no_m3       0.033    0.051    0.651    0.515
##  .wbc_m3 ~~                                           
##    .lymph_m3         -0.395    0.053   -7.458    0.000
##    .albumin_m3        0.065    0.046    1.419    0.156
##    .max_hct_m3       -0.013    0.044   -0.284    0.776
##    .platelets_m3      0.317    0.063    5.067    0.000
##    .tourn_no_m3      -0.203    0.058   -3.512    0.000
##  .lymph_m3 ~~                                         
##    .albumin_m3       -0.093    0.057   -1.650    0.099
##    .max_hct_m3       -0.031    0.051   -0.606    0.544
##    .platelets_m3     -0.173    0.064   -2.718    0.007
##    .tourn_no_m3       0.140    0.059    2.382    0.017
##  .albumin_m3 ~~                                       
##    .max_hct_m3        0.138    0.058    2.363    0.018
##    .platelets_m3      0.179    0.061    2.951    0.003
##    .tourn_no_m3      -0.031    0.061   -0.513    0.608
##  .max_hct_m3 ~~                                       
##    .platelets_m3     -0.090    0.065   -1.390    0.164
##    .tourn_no_m3       0.055    0.058    0.949    0.343
##  .platelets_m3 ~~                                     
##    .tourn_no_m3      -0.049    0.060   -0.812    0.417
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(>|z|)
##    .dhf               0.780    0.074   10.469    0.000
##    .ast_m1            0.822    0.425    1.934    0.053
##    .alt_m1            0.558    0.148    3.781    0.000
##    .wbc_m1            0.375    0.044    8.476    0.000
##    .lymph_m1          0.756    0.076    9.923    0.000
##    .albumin_m1        0.682    0.086    7.888    0.000
##    .max_hct_m1        0.560    0.068    8.191    0.000
##    .platelets_m1      0.490    0.047   10.410    0.000
##    .tourn_no_m1       0.645    0.053   12.198    0.000
##    .ast_m3            0.995    0.430    2.315    0.021
##    .alt_m3            0.986    0.409    2.411    0.016
##    .wbc_m3            0.962    0.248    3.882    0.000
##    .lymph_m3          0.878    0.083   10.547    0.000
##    .albumin_m3        0.991    0.102    9.700    0.000
##    .max_hct_m3        0.880    0.099    8.869    0.000
##    .platelets_m3      0.922    0.091   10.103    0.000
##    .tourn_no_m3       0.983    0.060   16.407    0.000
```


```r
#17 nodes
ly<-matrix(NA,18,2)
depVar='dhf'
med1=c('ast_m1','alt_m1','wbc_m1','lymph_m1','albumin_m1','max_hct_m1','platelets_m1','tourn_no_m1')
med2=c('ast_m3','alt_m3','wbc_m3','lymph_m3','albumin_m3','max_hct_m3','platelets_m3','tourn_no_m3')
indepVar='age_t'
labels=c()
labels[1]=depVar
ly[1,]=c(1,0)
y=1
for (x in c(1:length(med1))){
  ly[y+x,]=c(0.6,(x/8*1.6-1))
  labels[(x+y)]<-med1[x]
}
y=9
for (x in c(1:length(med2))){
  ly[y+x,]=c(-1,(x/8*1.6-1))
  labels[(x+y)]<-med2[x]
}
labels[18]=indepVar
ly[18,]=c(-0.5,1)
```


```r
table2<-parameterEstimates(fit,standardized=TRUE)%>%as.data.frame()
table2<-table2[!table2$lhs==table2$rhs,]
b<-gettextf('%.3f \n p=%.3f', table2$std.all, digits=table2$pvalue)
```

Visualization was generated using R's package `semPlots`


```r
semPaths(fit, layout=ly,
         edgeLabels=b,
         residuals=FALSE,
         style='ram',
         what='est',
         whatLabels = "std",
         sizeMan = 10, # Size of manifest variables
  sizeMan2=3,edge.label.cex = 0.8,label.cex=1,
  
  nCharNodes = 0,fade=TRUE,
  mar = c(1,3,1,3))
```

<<<<<<< HEAD
![unnamed-chunk-7-1.png](/1_Park2018_files/figure-html/unnamed-chunk-7-1.png)<!-- -->

