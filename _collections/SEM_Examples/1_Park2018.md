---
layout: single
author_profile: true
title: "Progression of Dengue illness phenotype - data from Park et al 2018"
shortdesc: "Modelling progression of the dengue illness phenotype. Replication of the SEM analysis presented in 
Park, S., Srikiatkhachorn, A., Kalayanarooj, S., Macareo, L., Green, S., Friedman, J. F., & Rothman, A. L. (2018)."
Method: "CB-SEM using R's `Lavaan` Package. The visualization was
generated using and `semPlots`'s Package."
Case: "a partial replication of an intermediary step in modelling
progression of the dengue illness phenotype."
Datafrom: "Park S, Srikiatkhachorn A, Kalayanarooj S, Macareo L, Green
S, Friedman JF, et al. (2018). Use of structural equation models to
predict dengue illness phenotype. PLoS Negl Trop Dis 12 (10): e0006799.
<https://doi.org/10.1371/journal>. pntd.0006799"
excerpt: "Some code examples using R"
header:
  overlay_color: "#333"
permalink: /collections/SEM_Examples/1_Park2018
date: "5/27/2022"
output: "html_document"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(lavaan)
library(semPlot)
```

# Objective

Modelling progression of the dengue illness phenotype. Replication of the SEM analysis presented in:

Park, S., Srikiatkhachorn, A., Kalayanarooj, S., Macareo, L., Green, S., Friedman, J. F., & Rothman, A. L. (2018). Use of structural equation models to predict dengue illness phenotype. PLoS Neglected Tropical Diseases, 12(10), 1--14. <https://doi.org/10.1371/journal.pntd.0006799>

The paper was worried about the evolution of the Dengue virus (DENV) infection, which, in severe cases, lead to Dengue Hemorrhagic Fever (DHF), characterized by fever, plasma leakage, bleeding diathesis and trombocytopenia. Platelet counts and hepatic parameters like ALT were monitored in three moments of time to model the progression of the phenotype in dengue illness.

# Data acquisition

```{r}
library(openxlsx)
data<-read.xlsx("Park2018.xlsx")
str(data)
library(stringr)
data$age_t<-as.numeric(str_extract(data$age2, "(\\d)+(?=-)"))
```

# SEM

**Original method:** SEM using Mplus 8 statistical software. SEM parameters were estimated using the weighted least squares means and variances adjusted estimator with the theta parameterization

**Method applied in this analysis:** CB-SEM with MLR estimator in R's package `Lavaan`.

```{r}
library(lavaan)
model="
  dhf~ast_m1+alt_m1+wbc_m1+lymph_m1+albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1+age_t
  ast_m1~alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  alt_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  wbc_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  lymph_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  albumin_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  max_hct_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  platelets_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  tourn_no_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3+age_t
  
  ast_m3~age_t
  alt_m3~age_t
  wbc_m3~age_t
  lymph_m3~age_t
  albumin_m3~age_t
  max_hct_m3~age_t
  platelets_m3~age_t
  tourn_no_m3~age_t
  
  # covariances
  ast_m1~~alt_m1+wbc_m1+lymph_m1+albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1
  alt_m1~~wbc_m1+lymph_m1+albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1
  wbc_m1~~lymph_m1+albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1
  lymph_m1~~albumin_m1+max_hct_m1+platelets_m1+tourn_no_m1
  albumin_m1~~max_hct_m1+platelets_m1+tourn_no_m1
  max_hct_m1~~platelets_m1+tourn_no_m1
  platelets_m1~~tourn_no_m1
  
  ast_m3~~alt_m3+wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3
  alt_m3~~wbc_m3+lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3
  wbc_m3~~lymph_m3+albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3
  lymph_m3~~albumin_m3+max_hct_m3+platelets_m3+tourn_no_m3
  albumin_m3~~max_hct_m3+platelets_m3+tourn_no_m3
  max_hct_m3~~platelets_m3+tourn_no_m3
  platelets_m3~~tourn_no_m3
  "
```

```{r}
fit=sem(model=model, data=data,std.ov=TRUE,estimator="MLR")
summary(fit)
```

```{r}
#17 nodes
ly<-matrix(NA,18,2)
depVar='dhf'
med1=c('ast_m1','alt_m1','wbc_m1','lymph_m1','albumin_m1','max_hct_m1','platelets_m1','tourn_no_m1')
med2=c('ast_m3','alt_m3','wbc_m3','lymph_m3','albumin_m3','max_hct_m3','platelets_m3','tourn_no_m3')
indepVar='age_t'
labels=c()
labels[1]=depVar
ly[1,]=c(1,0)
y=1
for (x in c(1:length(med1))){
  ly[y+x,]=c(0.6,(x/8*1.6-1))
  labels[(x+y)]<-med1[x]
}
y=9
for (x in c(1:length(med2))){
  ly[y+x,]=c(-1,(x/8*1.6-1))
  labels[(x+y)]<-med2[x]
}
labels[18]=indepVar
ly[18,]=c(-0.5,1)
```

```{r}
table2<-parameterEstimates(fit,standardized=TRUE)%>%as.data.frame()
table2<-table2[!table2$lhs==table2$rhs,]
b<-gettextf('%.3f \n p=%.3f', table2$std.all, digits=table2$pvalue)
```

Visualization was generated using R's package `semPlots`

```{r}
semPaths(fit, layout=ly,
         edgeLabels=b,
         residuals=FALSE,
         style='ram',
         what='est',
         whatLabels = "std",
         sizeMan = 10, # Size of manifest variables
  sizeMan2=3,edge.label.cex = 0.8,label.cex=1,
  
  nCharNodes = 0,fade=TRUE,
  mar = c(1,3,1,3))
```
