---
layout: single
author_profile: true
title: "1-Progression of Dengue illness phenotype - data from Park et al 2018"
category: SEM
shorttitle: "SEM_Park2018"
shortdesc: "Modelling progression of the dengue illness phenotype. Replication of the SEM analysis presented in 
Park, S., Srikiatkhachorn, A., Kalayanarooj, S., Macareo, L., Green, S., Friedman, J. F., & Rothman, A. L. (2018)."
Method: "CB-SEM using R's `Lavaan` Package. The visualization was
generated using and `semPlots`'s Package."
Case: "a partial replication of an intermediary step in modelling
progression of the dengue illness phenotype."
Datafrom: "Park S, Srikiatkhachorn A, Kalayanarooj S, Macareo L, Green
S, Friedman JF, et al. (2018). Use of structural equation models to
predict dengue illness phenotype. PLoS Negl Trop Dis 12 (10): e0006799.
<https://doi.org/10.1371/journal>. pntd.0006799"
excerpt: "Some code examples using R"
header:
  overlay_color: "#333"
permalink: /collections/SEM_Examples/1_Park2018
date: "2022-05-27"
---




# Objective

Modelling progression of the dengue illness phenotype. Replication of the SEM analysis presented in:

Park, S., Srikiatkhachorn, A., Kalayanarooj, S., Macareo, L., Green, S., Friedman, J. F., & Rothman, A. L. (2018). Use of structural equation models to predict dengue illness phenotype. PLoS Neglected Tropical Diseases, 12(10), 1--14. <https://doi.org/10.1371/journal.pntd.0006799>

The paper was worried about the evolution of the Dengue virus (DENV) infection, which, in severe cases, lead to Dengue Hemorrhagic Fever (DHF), characterized by fever, plasma leakage, bleeding diathesis and trombocytopenia. Platelet counts and hepatic parameters like ALT were monitored in three moments of time to model the progression of the phenotype in dengue illness.

**Original method:** SEM using Mplus 8 statistical software. SEM parameters were estimated using the weighted least squares means and variances adjusted estimator with the theta parameterization

**Method applied in this analysis:** CB-SEM with MLR estimator in R's package `Lavaan`.

# Data acquisition


```r
library(openxlsx)
```

```
## Warning: package 'openxlsx' was built under R version 4.1.3
```

```r
data<-read.xlsx("Park2018.xlsx")
```



Let's explore the datastructure.


```r
str(data)
```

```
## 'data.frame':	257 obs. of  22 variables:
##  $ age2        : chr  "12-13" "4-5" "4-5" "8-9" ...
##  $ sex         : num  1 1 2 2 1 1 1 1 2 2 ...
##  $ dengue      : num  1 1 0 1 1 0 1 1 1 1 ...
##  $ dhf         : num  1 0 0 0 0 0 0 0 0 0 ...
##  $ dhf34       : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ ast_m3      : num  25 38 27 167 29 39 32 48 36 35 ...
##  $ alt_m3      : num  10 14 9 109 13 15 10 23 18 16 ...
##  $ wbc_m3      : num  3600 7200 9200 2200 9500 8000 5200 5000 2800 6000 ...
##  $ lymph_m3    : num  16 21 13 34 7 21 16 18 37 11 ...
##  $ albumin_m3  : num  4.5 5.6 4.6 4.8 5 5.9 4.6 3.9 4 4.2 ...
##  $ max_hct_m3  : num  42.5 38 37 40 38 40 42.5 39 38 40 ...
##  $ platelets_m3: num  271000 272000 216000 227000 204000 287000 266000 307000 206000 273000 ...
##  $ tourn_no_m3 : num  21 21 10 21 5 8 21 4 6 4 ...
##  $ ast_m1      : num  53 36 26 248 34 35 43 43 240 97 ...
##  $ alt_m1      : num  15 14 11 174 14 11 9 24 126 28 ...
##  $ wbc_m1      : num  2300 5100 3800 1600 6500 7300 2800 3800 600 3300 ...
##  $ lymph_m1    : num  32 60 41 39 61 45 24 35 42 32 ...
##  $ albumin_m1  : num  4.3 4.6 3.7 4.5 4.9 4.9 3.9 3.8 4.4 4.5 ...
##  $ max_hct_m1  : num  43 39 37 40 36 37 41 39 38 45 ...
##  $ platelets_m1: num  73000 263000 200000 116000 163000 262000 168000 147000 180000 106000 ...
##  $ tourn_no_m1 : num  21 21 0 21 2 4 21 20 14 21 ...
##  $ age_t       : num  12 4 4 8 6 4 8 8 4 6 ...
```

In this dataset, outcomes cannot be described by a single parameter, but by a set of complementary and possibly multicollinear parameters. Note also that the parameters monitored and assessed multiple times over a specific period, as the time for results to become apparent can also vary. Such sequential measures are certainly associated. Notably, the intervention improves or worsens, but the ultimate level of results depends on the initial measure.

The same parameters (like platelet count and ALT levels) are assessed both 3 days and 1 day before the event (indicated with m3 and m1 at the end of the variable name).

# Model

So, the model reflect such association:

-   causal relation among dhf (dengue hemorrhagic fever) and measures 1 day before the event

-   the measures at 1 day before the event as potentially influenced by all the measures at 3 days before the event.

-   hypotheses about the influence of age in the outcome, but also on measures at m3

-   and consider also that the measures can be correlated each other (for example, ALT and AST are known enzimes associated with hepatotoxicity, for example.


```r
library(lavaan)
model="
  dhf~alt_m1+lymph_m1+max_hct_m1+platelets_m1
  ast_m1~alt_m3+wbc_m3+lymph_m3+albumin_m3+platelets_m3+age_t+ast_m3  
  alt_m1~alt_m3+wbc_m3+lymph_m3+albumin_m3+platelets_m3+ast_m3
  wbc_m1~ast_m3+alt_m3+wbc_m3+lymph_m3+albumin_m3+age_t
  lymph_m1~wbc_m3+lymph_m3+max_hct_m3+age_t
  albumin_m1~ast_m3+alt_m3+albumin_m3+platelets_m3
  max_hct_m1~wbc_m3+lymph_m3+albumin_m3+max_hct_m3+age_t
  platelets_m1~wbc_m3+lymph_m3+platelets_m3
  tourn_no_m1~ast_m3+wbc_m3+lymph_m3+albumin_m3+tourn_no_m3+age_t
  
  
  alt_m3~age_t
  wbc_m3~age_t
  lymph_m3~age_t
  max_hct_m3~age_t
  platelets_m3~age_t
  tourn_no_m3~age_t
  
  # covariances
  ast_m1~~alt_m1+albumin_m1+max_hct_m1
  alt_m1~~albumin_m1+max_hct_m1
  wbc_m1~~lymph_m1+platelets_m1
  lymph_m1~~tourn_no_m1
  albumin_m1~~platelets_m1
  max_hct_m1~~platelets_m1+tourn_no_m1
  platelets_m1~~tourn_no_m1
  
  ast_m3~~wbc_m3+platelets_m3 
  alt_m3~~wbc_m3+platelets_m3+ast_m3
  wbc_m3~~lymph_m3+platelets_m3+tourn_no_m3
  lymph_m3~~platelets_m3+tourn_no_m3
  max_hct_m3~~platelets_m3
  "
```


```r
fit=sem(model=model, data=data,std.ov=TRUE,estimator="MLR",fixed.x = FALSE)
```

# visualization
Visualization was generated using R's package `semPlots`, with some adjustment of the coordinates for each of the variables, and also adding p values for paths.


```r
#17 nodes
ly<-matrix(NA,18,2)
depVar='dhf'
med1=c('ast_m1','alt_m1','wbc_m1','lymph_m1','albumin_m1','max_hct_m1','platelets_m1','tourn_no_m1')
med2=c('ast_m3','alt_m3','wbc_m3','lymph_m3','albumin_m3','max_hct_m3','platelets_m3','tourn_no_m3')
indepVar='age_t'
labels=c()
labels[1]=depVar
ly[1,]=c(1,0)
y=1
for (x in c(1:length(med1))){
  ly[y+x,]=c(0.6,(x/8*1.6-1))
  labels[(x+y)]<-med1[x]
}
y=9
for (x in c(1:length(med2))){
  ly[y+x,]=c(-1,(x/8*1.6-1))
  labels[(x+y)]<-med2[x]
}
labels[18]=indepVar
ly[18,]=c(-0.5,1)

table2<-parameterEstimates(fit,standardized=TRUE)%>%as.data.frame()
table2<-table2[!table2$lhs==table2$rhs,]
b<-gettextf('%.3f \n p=%.3f', table2$std.all, digits=table2$pvalue)

semPaths(fit, layout=ly,
         edgeLabels=b,
         residuals=FALSE,
         style='ram',
         what='est',
         whatLabels = "std",
         cut=0.3,
         sizeMan = 10, # Size of manifest variables
  sizeMan2=3,edge.label.cex = 0.8,label.cex=1,
  
  nCharNodes = 0,fade=TRUE,
  mar = c(1,3,1,3))
```

![](https://github.com/TomoeGusberti/tomoegusberti.github.io/blob/master/_collections/SEM_Examples/1_Park2018_files/Park2018.png?raw=true)<!-- -->

Attend how the association among the sequential measures of the variables (m1 and m3) is fragrant. Also note the different parameters are associated. For example, the AST levels on day 3 are significantly associated with albumin levels on day 1.

<!-- -->

# Parameter table

The summarisation on fit measures and  parameter estimates are presented bellow:


```r
summary(fit, fit.measures=TRUE)
```

```
## lavaan 0.6-11 ended normally after 48 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                       102
##                                                       
##   Number of observations                           257
##                                                       
## Model Test User Model:
##                                                Standard      Robust
##   Test Statistic                                 99.387      91.350
##   Degrees of freedom                                 69          69
##   P-value (Chi-square)                            0.010       0.037
##   Scaling correction factor                                   1.088
##        Yuan-Bentler correction (Mplus variant)                     
## 
## Model Test Baseline Model:
## 
##   Test statistic                              2032.225    1299.643
##   Degrees of freedom                               152         152
##   P-value                                        0.000       0.000
##   Scaling correction factor                                  1.564
## 
## User Model versus Baseline Model:
## 
##   Comparative Fit Index (CFI)                    0.984       0.981
##   Tucker-Lewis Index (TLI)                       0.964       0.957
##                                                                   
##   Robust Comparative Fit Index (CFI)                         0.986
##   Robust Tucker-Lewis Index (TLI)                            0.970
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -5587.968   -5587.968
##   Scaling correction factor                                  2.743
##       for the MLR correction                                      
##   Loglikelihood unrestricted model (H1)      -5538.274   -5538.274
##   Scaling correction factor                                  2.075
##       for the MLR correction                                      
##                                                                   
##   Akaike (AIC)                               11379.935   11379.935
##   Bayesian (BIC)                             11741.941   11741.941
##   Sample-size adjusted Bayesian (BIC)        11418.570   11418.570
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.041       0.036
##   90 Percent confidence interval - lower         0.021       0.011
##   90 Percent confidence interval - upper         0.059       0.053
##   P-value RMSEA <= 0.05                          0.779       0.908
##                                                                   
##   Robust RMSEA                                               0.037
##   90 Percent confidence interval - lower                     0.010
##   90 Percent confidence interval - upper                     0.056
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.054       0.054
## 
## Parameter Estimates:
## 
##   Standard errors                             Sandwich
##   Information bread                           Observed
##   Observed information based on                Hessian
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(>|z|)
##   dhf ~                                               
##     alt_m1            0.160    0.059    2.704    0.007
##     lymph_m1         -0.107    0.053   -2.004    0.045
##     max_hct_m1        0.197    0.057    3.449    0.001
##     platelets_m1     -0.243    0.054   -4.461    0.000
##   ast_m1 ~                                            
##     alt_m3           -0.250    0.057   -4.380    0.000
##     wbc_m3           -0.056    0.035   -1.633    0.102
##     lymph_m3         -0.161    0.051   -3.154    0.002
##     albumin_m3       -0.042    0.025   -1.668    0.095
##     platelets_m3     -0.137    0.058   -2.358    0.018
##     age_t            -0.073    0.071   -1.037    0.300
##     ast_m3            0.749    0.105    7.138    0.000
##   alt_m1 ~                                            
##     alt_m3            0.271    0.155    1.751    0.080
##     wbc_m3           -0.071    0.039   -1.845    0.065
##     lymph_m3         -0.093    0.031   -3.012    0.003
##     albumin_m3       -0.068    0.038   -1.784    0.074
##     platelets_m3     -0.093    0.035   -2.699    0.007
##     ast_m3            0.445    0.084    5.304    0.000
##   wbc_m1 ~                                            
##     ast_m3            0.223    0.062    3.595    0.000
##     alt_m3           -0.100    0.040   -2.522    0.012
##     wbc_m3            0.807    0.056   14.528    0.000
##     lymph_m3          0.129    0.040    3.205    0.001
##     albumin_m3       -0.104    0.041   -2.522    0.012
##     age_t            -0.054    0.040   -1.344    0.179
##   lymph_m1 ~                                          
##     wbc_m3           -0.199    0.049   -4.045    0.000
##     lymph_m3          0.281    0.069    4.053    0.000
##     max_hct_m3       -0.079    0.054   -1.466    0.143
##     age_t            -0.175    0.062   -2.818    0.005
##   albumin_m1 ~                                        
##     ast_m3           -0.108    0.059   -1.829    0.067
##     alt_m3            0.008    0.043    0.185    0.853
##     albumin_m3        0.501    0.054    9.339    0.000
##     platelets_m3      0.104    0.054    1.921    0.055
##   max_hct_m1 ~                                        
##     wbc_m3           -0.106    0.051   -2.099    0.036
##     lymph_m3         -0.147    0.050   -2.918    0.004
##     albumin_m3       -0.071    0.047   -1.524    0.128
##     max_hct_m3        0.498    0.072    6.960    0.000
##     age_t             0.178    0.056    3.180    0.001
##   platelets_m1 ~                                      
##     wbc_m3            0.312    0.073    4.274    0.000
##     lymph_m3          0.085    0.049    1.709    0.087
##     platelets_m3      0.519    0.057    9.083    0.000
##   tourn_no_m1 ~                                       
##     ast_m3            0.125    0.037    3.406    0.001
##     wbc_m3           -0.132    0.048   -2.787    0.005
##     lymph_m3         -0.136    0.061   -2.239    0.025
##     albumin_m3       -0.074    0.049   -1.514    0.130
##     tourn_no_m3       0.464    0.052    8.916    0.000
##     age_t             0.114    0.055    2.077    0.038
##   alt_m3 ~                                            
##     age_t             0.127    0.040    3.135    0.002
##   wbc_m3 ~                                            
##     age_t            -0.192    0.051   -3.721    0.000
##   lymph_m3 ~                                          
##     age_t            -0.345    0.061   -5.639    0.000
##   max_hct_m3 ~                                        
##     age_t             0.341    0.061    5.618    0.000
##   platelets_m3 ~                                      
##     age_t            -0.280    0.061   -4.619    0.000
##   tourn_no_m3 ~                                       
##     age_t             0.116    0.062    1.866    0.062
## 
## Covariances:
##                    Estimate  Std.Err  z-value  P(>|z|)
##  .ast_m1 ~~                                           
##    .alt_m1            0.365    0.190    1.924    0.054
##    .albumin_m1        0.118    0.107    1.098    0.272
##    .max_hct_m1       -0.063    0.035   -1.795    0.073
##  .alt_m1 ~~                                           
##    .albumin_m1        0.094    0.053    1.764    0.078
##    .max_hct_m1       -0.036    0.027   -1.328    0.184
##  .wbc_m1 ~~                                           
##    .lymph_m1         -0.108    0.036   -2.957    0.003
##    .platelets_m1      0.115    0.025    4.607    0.000
##  .lymph_m1 ~~                                         
##    .tourn_no_m1      -0.113    0.041   -2.730    0.006
##  .albumin_m1 ~~                                       
##    .platelets_m1      0.157    0.037    4.194    0.000
##  .max_hct_m1 ~~                                       
##    .platelets_m1     -0.111    0.039   -2.871    0.004
##    .tourn_no_m1       0.108    0.041    2.626    0.009
##  .platelets_m1 ~~                                     
##    .tourn_no_m1      -0.056    0.037   -1.530    0.126
##  .wbc_m3 ~~                                           
##     ast_m3           -0.162    0.035   -4.688    0.000
##  .platelets_m3 ~~                                     
##     ast_m3           -0.184    0.092   -1.996    0.046
##  .alt_m3 ~~                                           
##    .wbc_m3           -0.118    0.033   -3.559    0.000
##    .platelets_m3     -0.095    0.054   -1.784    0.074
##     ast_m3            0.743    0.274    2.710    0.007
##  .wbc_m3 ~~                                           
##    .lymph_m3         -0.379    0.051   -7.499    0.000
##    .platelets_m3      0.299    0.058    5.130    0.000
##    .tourn_no_m3      -0.178    0.053   -3.366    0.001
##  .lymph_m3 ~~                                         
##    .platelets_m3     -0.153    0.061   -2.530    0.011
##    .tourn_no_m3       0.137    0.057    2.403    0.016
##  .max_hct_m3 ~~                                       
##    .platelets_m3     -0.078    0.055   -1.424    0.154
##  .dhf ~~                                              
##    .ast_m1            0.017    0.023    0.746    0.456
##    .wbc_m1            0.019    0.027    0.691    0.490
##    .albumin_m1       -0.018    0.045   -0.404    0.686
##    .tourn_no_m1       0.054    0.041    1.311    0.190
##  .ast_m1 ~~                                           
##    .wbc_m1           -0.010    0.016   -0.604    0.546
##    .tourn_no_m1       0.001    0.016    0.075    0.940
##  .wbc_m1 ~~                                           
##    .albumin_m1        0.022    0.033    0.662    0.508
##    .tourn_no_m1      -0.019    0.027   -0.719    0.472
##  .albumin_m1 ~~                                       
##    .tourn_no_m1      -0.026    0.038   -0.666    0.506
##   albumin_m3 ~~                                       
##     age_t             0.068    0.060    1.136    0.256
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(>|z|)
##    .dhf               0.804    0.078   10.305    0.000
##    .ast_m1            0.571    0.394    1.449    0.147
##    .alt_m1            0.462    0.146    3.153    0.002
##    .wbc_m1            0.382    0.044    8.675    0.000
##    .lymph_m1          0.768    0.079    9.739    0.000
##    .albumin_m1        0.689    0.087    7.956    0.000
##    .max_hct_m1        0.587    0.079    7.412    0.000
##    .platelets_m1      0.500    0.045   11.006    0.000
##    .tourn_no_m1       0.647    0.053   12.104    0.000
##    .alt_m3            0.987    0.408    2.417    0.016
##    .wbc_m3            0.943    0.244    3.869    0.000
##    .lymph_m3          0.877    0.083   10.608    0.000
##    .max_hct_m3        0.880    0.099    8.869    0.000
##    .platelets_m3      0.914    0.090   10.187    0.000
##    .tourn_no_m3       0.983    0.060   16.407    0.000
##     ast_m3            0.996    0.428    2.329    0.020
##     albumin_m3        0.996    0.102    9.727    0.000
##     age_t             0.996    0.068   14.642    0.000
```

